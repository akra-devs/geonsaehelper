From dd538ff92b6ac3d02b2cacb1374fd850768c06b0 Mon Sep 17 00:00:00 2001
From: codex <codex@example.com>
Date: Wed, 3 Sep 2025 10:48:36 +0900
Subject: [PATCH 01/13] chore(repo): remove stray Zone.Identifier files and
 clean lib/lib directory

---
 "lib/lib/main.dart\357\200\272Zone.Identifier"                    | 0
 .../ui/components/chat_bubble.dart\357\200\272Zone.Identifier"    | 0
 .../components/intake_question.dart\357\200\272Zone.Identifier"   | 0
 .../ui/components/result_card.dart\357\200\272Zone.Identifier"    | 0
 "lib/lib/ui/demo/demo_gallery.dart\357\200\272Zone.Identifier"    | 0
 "lib/lib/ui/theme/app_theme.dart\357\200\272Zone.Identifier"      | 0
 6 files changed, 0 insertions(+), 0 deletions(-)
 delete mode 100644 "lib/lib/main.dart\357\200\272Zone.Identifier"
 delete mode 100644 "lib/lib/ui/components/chat_bubble.dart\357\200\272Zone.Identifier"
 delete mode 100644 "lib/lib/ui/components/intake_question.dart\357\200\272Zone.Identifier"
 delete mode 100644 "lib/lib/ui/components/result_card.dart\357\200\272Zone.Identifier"
 delete mode 100644 "lib/lib/ui/demo/demo_gallery.dart\357\200\272Zone.Identifier"
 delete mode 100644 "lib/lib/ui/theme/app_theme.dart\357\200\272Zone.Identifier"

diff --git "a/lib/lib/main.dart\357\200\272Zone.Identifier" "b/lib/lib/main.dart\357\200\272Zone.Identifier"
deleted file mode 100644
index e69de29..0000000
diff --git "a/lib/lib/ui/components/chat_bubble.dart\357\200\272Zone.Identifier" "b/lib/lib/ui/components/chat_bubble.dart\357\200\272Zone.Identifier"
deleted file mode 100644
index e69de29..0000000
diff --git "a/lib/lib/ui/components/intake_question.dart\357\200\272Zone.Identifier" "b/lib/lib/ui/components/intake_question.dart\357\200\272Zone.Identifier"
deleted file mode 100644
index e69de29..0000000
diff --git "a/lib/lib/ui/components/result_card.dart\357\200\272Zone.Identifier" "b/lib/lib/ui/components/result_card.dart\357\200\272Zone.Identifier"
deleted file mode 100644
index e69de29..0000000
diff --git "a/lib/lib/ui/demo/demo_gallery.dart\357\200\272Zone.Identifier" "b/lib/lib/ui/demo/demo_gallery.dart\357\200\272Zone.Identifier"
deleted file mode 100644
index e69de29..0000000
diff --git "a/lib/lib/ui/theme/app_theme.dart\357\200\272Zone.Identifier" "b/lib/lib/ui/theme/app_theme.dart\357\200\272Zone.Identifier"
deleted file mode 100644
index e69de29..0000000
-- 
2.39.5 (Apple Git-154)


From 5472bfb043974bf5c559a8a6384a0d214fd5caef Mon Sep 17 00:00:00 2001
From: codex <codex@example.com>
Date: Wed, 3 Sep 2025 11:00:58 +0900
Subject: [PATCH 02/13] fix(conversation): prevent crash when answering survey
 questions by resolving question from current phase and safely mapping labels

---
 .../conversation/ui/conversation_page.dart       | 13 ++++++++++---
 pubspec.lock                                     | 16 ++++++++--------
 2 files changed, 18 insertions(+), 11 deletions(-)

diff --git a/lib/features/conversation/ui/conversation_page.dart b/lib/features/conversation/ui/conversation_page.dart
index 4a0cdb5..6b2f74f 100644
--- a/lib/features/conversation/ui/conversation_page.dart
+++ b/lib/features/conversation/ui/conversation_page.dart
@@ -67,7 +67,12 @@ class _ConversationPageState extends State<ConversationPage> {
 
   void _onChoiceSelected(String qid, String? value) {
     if (value == null) return;
-    final q = _flow.firstWhere((e) => e.qid == qid);
+    // Resolve the question from the current phase's list (survey vs intake)
+    final list = _phase == _Phase.survey ? _surveyFlow : _flow;
+    final q = list.firstWhere(
+      (e) => e.qid == qid,
+      orElse: () => _Question(qid: qid, label: qid, choices: const []),
+    );
     final label = _labelFor(q, value);
     _appendUserText(label);
     _answers[qid] = value;
@@ -77,7 +82,7 @@ class _ConversationPageState extends State<ConversationPage> {
     }
     setState(() => _awaitingChoice = false);
 
-    final list = _phase == _Phase.survey ? _surveyFlow : _flow;
+    // Advance within the current phase
     if (_step < list.length - 1) {
       _step += 1;
       _askCurrent();
@@ -104,7 +109,9 @@ class _ConversationPageState extends State<ConversationPage> {
 
   String _labelFor(_Question q, String value) {
     if (value == _unknown) return 'ëª¨ë¦„';
-    return q.choices.firstWhere((c) => c.value == value).text;
+    // Safe lookup: fall back to raw value if not found
+    final match = q.choices.where((c) => c.value == value);
+    return match.isNotEmpty ? match.first.text : value;
   }
 
   void _evaluateAndShow() {
diff --git a/pubspec.lock b/pubspec.lock
index 6dd85e4..2008e41 100644
--- a/pubspec.lock
+++ b/pubspec.lock
@@ -29,10 +29,10 @@ packages:
     dependency: transitive
     description:
       name: async
-      sha256: d2872f9c19731c2e5f10444b14686eb7cc85c76274bd6c16e1816bff9a3bab63
+      sha256: "758e6d74e971c3e5aceb4110bfd6698efc7f501675bcfe0c775459a8140750eb"
       url: "https://pub.dev"
     source: hosted
-    version: "2.12.0"
+    version: "2.13.0"
   bloc:
     dependency: transitive
     description:
@@ -189,10 +189,10 @@ packages:
     dependency: transitive
     description:
       name: fake_async
-      sha256: "6a95e56b2449df2273fd8c45a662d6947ce1ebb7aafe80e550a3f68297f3cacc"
+      sha256: "5368f224a74523e8d2e7399ea1638b37aecfca824a3cc4dfdf77bf1fa905ac44"
       url: "https://pub.dev"
     source: hosted
-    version: "1.3.2"
+    version: "1.3.3"
   ffi:
     dependency: transitive
     description:
@@ -348,10 +348,10 @@ packages:
     dependency: transitive
     description:
       name: leak_tracker
-      sha256: c35baad643ba394b40aac41080300150a4f08fd0fd6a10378f8f7c6bc161acec
+      sha256: "6bb818ecbdffe216e81182c2f0714a2e62b593f4a4f13098713ff1685dfb6ab0"
       url: "https://pub.dev"
     source: hosted
-    version: "10.0.8"
+    version: "10.0.9"
   leak_tracker_flutter_testing:
     dependency: transitive
     description:
@@ -689,10 +689,10 @@ packages:
     dependency: transitive
     description:
       name: vm_service
-      sha256: "0968250880a6c5fe7edc067ed0a13d4bae1577fe2771dcf3010d52c4a9d3ca14"
+      sha256: ddfa8d30d89985b96407efce8acbdd124701f96741f2d981ca860662f1c0dc02
       url: "https://pub.dev"
     source: hosted
-    version: "14.3.1"
+    version: "15.0.0"
   watcher:
     dependency: transitive
     description:
-- 
2.39.5 (Apple Git-154)


From 25690379ad2baff10bcf88020258f8553c1ffeda Mon Sep 17 00:00:00 2001
From: codex <codex@example.com>
Date: Wed, 3 Sep 2025 11:34:05 +0900
Subject: [PATCH 03/13] docs(ia): canonicalize docs, fix IA conflict (tabs),
 add status headers and update index

---
 docs/docs/APP_SCREEN_PLAN.md       |  1 +
 docs/docs/COMPONENT_SPECS.md       |  1 +
 docs/docs/DOCS_INDEX.md            | 14 ++++++++++++++
 docs/docs/FLUTTER_DESIGN_SYSTEM.md |  2 +-
 docs/docs/INTAKE_FLOW.md           |  1 +
 docs/docs/MEASUREMENT_PLAN.md      |  1 +
 docs/docs/OPERATIONS_RUNBOOK.md    |  1 +
 docs/docs/PRD_v1.md                |  1 +
 docs/docs/PRODUCT_BRIEF.md         |  1 +
 docs/docs/PRODUCT_PLAN_MVP.md      |  7 ++++---
 docs/docs/RAG_POLICY.md            |  1 +
 docs/docs/RULES_HUG_v1.md          |  1 +
 docs/docs/SCREEN_SPECS.md          |  1 +
 docs/docs/UI_UX_GUIDE.md           |  6 +++---
 14 files changed, 32 insertions(+), 7 deletions(-)

diff --git a/docs/docs/APP_SCREEN_PLAN.md b/docs/docs/APP_SCREEN_PLAN.md
index d573e89..6eadf36 100644
--- a/docs/docs/APP_SCREEN_PLAN.md
+++ b/docs/docs/APP_SCREEN_PLAN.md
@@ -1,4 +1,5 @@
 # APP_SCREEN_PLAN â€” ì±—ë´‡í˜•(ì„ íƒí˜•+ëŒ€í™”í˜•) í™”ë©´ ê¸°íš
+Status: canonical (Screen Flow)
 
 ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-02
 
diff --git a/docs/docs/COMPONENT_SPECS.md b/docs/docs/COMPONENT_SPECS.md
index 1c7d63b..367d2bf 100644
--- a/docs/docs/COMPONENT_SPECS.md
+++ b/docs/docs/COMPONENT_SPECS.md
@@ -1,4 +1,5 @@
 # COMPONENT_SPECS â€” ê³µìš© ìœ„ì ¯ ì‚¬ì–‘(Flutter API ì´ˆì•ˆ)
+Status: canonical (Component APIs)
 
 ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-02
 
diff --git a/docs/docs/DOCS_INDEX.md b/docs/docs/DOCS_INDEX.md
index ebaa96a..b984abf 100644
--- a/docs/docs/DOCS_INDEX.md
+++ b/docs/docs/DOCS_INDEX.md
@@ -1,4 +1,5 @@
 # DOCS_INDEX â€” ë¬¸ì„œ ì¸ë±ìŠ¤ & ì—°ê´€ì„± ë§µ
+Status: canonical (Information Architecture)
 
 ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-02
 
@@ -9,6 +10,19 @@
 4) ì¸¡ì •/ìš´ì˜/ë²•/ê´‘ê³  â€” MEASUREMENT_PLAN.md, OPERATIONS_RUNBOOK.md, LEGAL_CHECKLIST.md, ADS_POLICY.md
 5) ì‹¤í–‰ ê³„íš â€” PRODUCT_PLAN_MVP.md, BACKLOG_EPICS_USER_STORIES.md
 
+## Canonical Set
+- Product: PRD_v1.md (PRODUCT_BRIEF.mdëŠ” ìš”ì•½ë³¸)
+- Intake: INTAKE_FLOW.md
+- Rules: RULES_HUG_v1.md + RULES_HUG_mapping.yaml
+- RAG: RAG_POLICY.md
+- UI Design: DESIGN_TOKENS.yaml, UI_BLUEPRINT.yaml
+- Component APIs: COMPONENT_SPECS.md
+- Screen Flow/Specs: APP_SCREEN_PLAN.md, SCREEN_SPECS.md
+- UX Guide: UI_UX_GUIDE.md, Flutter implementation: FLUTTER_DESIGN_SYSTEM.md
+- Measurement: MEASUREMENT_PLAN.md
+- Operations: OPERATIONS_RUNBOOK.md, Release: RELEASE_PLAN.md
+- Legal/Ads: LEGAL_CHECKLIST.md, ADS_POLICY.md
+
 ## ì—°ê´€ì„±(ìš”ì•½)
 - PRD_v1.md â†’ í™”ë©´/ì»´í¬ë„ŒíŠ¸ì˜ ìˆ˜ìš©ê¸°ì¤€ê³¼ ì½˜í…ì¸  ë²”ìœ„ ì •ì˜
 - RULES_HUG_v1.md â†’ ê²°ê³¼ ì¹´ë“œ ìƒíƒœ/ì‚¬ìœ /â€˜ëª¨ë¦„â€™ ì²˜ë¦¬ ê·œì •ì˜ ê·¼ê±°
diff --git a/docs/docs/FLUTTER_DESIGN_SYSTEM.md b/docs/docs/FLUTTER_DESIGN_SYSTEM.md
index 02649cc..e268a62 100644
--- a/docs/docs/FLUTTER_DESIGN_SYSTEM.md
+++ b/docs/docs/FLUTTER_DESIGN_SYSTEM.md
@@ -1,4 +1,5 @@
 # FLUTTER_DESIGN_SYSTEM â€” Flutter UI ì‘ì„± ê°€ì´ë“œ(ì‹¤í–‰ ì§€í–¥)
+Status: derived (Implementation guide). Canonical: DESIGN_TOKENS.yaml, COMPONENT_SPECS.md, UI_UX_GUIDE.md
 
 ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-02
 ë²”ìœ„: ë””ìì¸ í† í° â†’ ThemeData/ThemeExtension ë§¤í•‘ â†’ ì»´í¬ë„ŒíŠ¸ ê·œì•½ â†’ ì ‘ê·¼ì„±/ë°˜ì‘í˜•/í…ŒìŠ¤íŠ¸.
@@ -115,4 +116,3 @@ ThemeData buildAppTheme(Brightness brightness) {
 - DESIGN_TOKENS.yaml â†’ ThemeExtension ë§¤í•‘ í™•ì¸
 - ì»´í¬ë„ŒíŠ¸ê°€ Theme/Extension í† í°ë§Œ ì°¸ì¡°(í•˜ë“œì½”ë”© X)
 - TestKey ë¶€ì°©, ê³¨ë“  ìŠ¤ëƒ…ìƒ· í†µê³¼
-
diff --git a/docs/docs/INTAKE_FLOW.md b/docs/docs/INTAKE_FLOW.md
index 108e532..c03cdcc 100644
--- a/docs/docs/INTAKE_FLOW.md
+++ b/docs/docs/INTAKE_FLOW.md
@@ -1,4 +1,5 @@
 # INTAKE_FLOW â€” ëŒ€í™”í˜• ì¸í…Œì´í¬ ì„¤ê³„(HUG ìê²© íŒì •)
+Status: canonical (Intake Script)
 
 ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-02
 
diff --git a/docs/docs/MEASUREMENT_PLAN.md b/docs/docs/MEASUREMENT_PLAN.md
index 0128fc8..ff896f8 100644
--- a/docs/docs/MEASUREMENT_PLAN.md
+++ b/docs/docs/MEASUREMENT_PLAN.md
@@ -1,4 +1,5 @@
 # MEASUREMENT_PLAN â€” ì¸¡ì •/ê³„ì¸¡ ê³„íš
+Status: canonical (Analytics Schema)
 
 ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-02
 
diff --git a/docs/docs/OPERATIONS_RUNBOOK.md b/docs/docs/OPERATIONS_RUNBOOK.md
index 967f248..cce501e 100644
--- a/docs/docs/OPERATIONS_RUNBOOK.md
+++ b/docs/docs/OPERATIONS_RUNBOOK.md
@@ -1,4 +1,5 @@
 # OPERATIONS_RUNBOOK â€” ìš´ì˜ ëŸ°ë¶(ê·œì • ê°±ì‹ /ì •ì •/í•«í”½ìŠ¤)
+Status: canonical (Operations)
 
 ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-02
 
diff --git a/docs/docs/PRD_v1.md b/docs/docs/PRD_v1.md
index 5df61b6..fe267e5 100644
--- a/docs/docs/PRD_v1.md
+++ b/docs/docs/PRD_v1.md
@@ -1,4 +1,5 @@
 # PRD v1 â€” ì „ì„¸ìê¸ˆëŒ€ì¶œ ìê²© íŒë³„ + AI Q&A (HUG ìš°ì„ )
+Status: canonical (Product Requirements)
 
 ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-02
 
diff --git a/docs/docs/PRODUCT_BRIEF.md b/docs/docs/PRODUCT_BRIEF.md
index 619d03d..953174f 100644
--- a/docs/docs/PRODUCT_BRIEF.md
+++ b/docs/docs/PRODUCT_BRIEF.md
@@ -1,4 +1,5 @@
 # ì œí’ˆ ê¸°íš í•µì‹¬ ìš”ì•½ ë° ì§„í–‰ ê¸°ë¡
+Status: derived (Executive summary). Canonical: PRD_v1.md
 
 ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-02
 
diff --git a/docs/docs/PRODUCT_PLAN_MVP.md b/docs/docs/PRODUCT_PLAN_MVP.md
index e03f04e..f3ead92 100644
--- a/docs/docs/PRODUCT_PLAN_MVP.md
+++ b/docs/docs/PRODUCT_PLAN_MVP.md
@@ -18,10 +18,12 @@
 - í’ˆì§ˆ: ê²°ê³¼ ë§Œì¡±(ğŸ‘) â‰¥ 70%, â€œì‚¬ìœ  ë³´ê¸°â€ â‰¥ 40%, ì •ì • ìš”ì²­ â‰¤ 5%
 - ë¦¬í…ì…˜: í›„ì† Q&A ì§„ì… â‰¥ 50%, D7 ì¬ë°©ë¬¸ â‰¥ 25%
 
+Status: canonical (Plan & Roadmap)
+
 ## 5) ì •ë³´ êµ¬ì¡°(IA)/ë„¤ë¹„ê²Œì´ì…˜
 - ê¸°ë³¸ ì§„ì…: Conversation(ëŒ€í™”)
-- ë³´ì¡° í™”ë©´: Home(ì„ íƒ), DocsChecklist, History, Settings
-- í•˜ë‹¨ íƒ­ ì—†ìŒ, AppBar ì•¡ì…˜/CTA ì¤‘ì‹¬
+- ë³´ì¡° í™”ë©´: DocsChecklist, History, Settings
+- í•˜ë‹¨ íƒ­: 4-íƒ­(ì‹œì‘/ì²´í¬ë¦¬ìŠ¤íŠ¸/íˆìŠ¤í† ë¦¬/ì„¤ì •) â€” êµ¬í˜„ê³¼ ì¼ì¹˜(AppShell ê¸°ì¤€)
 
 ## 6) í•µì‹¬ í”Œë¡œìš°
 - ì¸í…Œì´í¬ â†’ ê²°ê³¼ ì¹´ë“œ ì¸ë¼ì¸ â†’ Q&A â†’ ì²´í¬ë¦¬ìŠ¤íŠ¸/í•œë„/í™•ì¸ ë°©ë²• â†’ íˆìŠ¤í† ë¦¬ ì €ì¥/ì¬ë°©ë¬¸
@@ -77,4 +79,3 @@
 
 ## 16) ì°¸ì¡°
 - PRD_v1.md, PRODUCT_BRIEF.md, INTAKE_FLOW.md, RULES_HUG_v1.md, RULES_HUG_mapping.yaml, RAG_POLICY.md, UI_UX_GUIDE.md, APP_SCREEN_PLAN.md, SCREEN_SPECS.md, UI_BLUEPRINT.yaml, DESIGN_TOKENS.yaml, COMPONENT_SPECS.md, COPY_GUIDE.md, RESULT_CARD_COPY.md, MEASUREMENT_PLAN.md, OPERATIONS_RUNBOOK.md, ADS_POLICY.md, LEGAL_CHECKLIST.md
-
diff --git a/docs/docs/RAG_POLICY.md b/docs/docs/RAG_POLICY.md
index e811cb3..d699975 100644
--- a/docs/docs/RAG_POLICY.md
+++ b/docs/docs/RAG_POLICY.md
@@ -1,4 +1,5 @@
 # RAG_POLICY â€” ë‚´ë¶€ ë¬¸ì„œ ê¸°ë°˜ ê²€ìƒ‰/ë‹µë³€ ì •ì±…
+Status: canonical (RAG Policy)
 
 ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-02
 
diff --git a/docs/docs/RULES_HUG_v1.md b/docs/docs/RULES_HUG_v1.md
index 4ae9f27..6804b3a 100644
--- a/docs/docs/RULES_HUG_v1.md
+++ b/docs/docs/RULES_HUG_v1.md
@@ -1,4 +1,5 @@
 # RULES_HUG_v1 â€” HUG ìê²© íŒì • ê·œì¹™(ì´ˆì•ˆ)
+Status: canonical (Eligibility Rules). Data: RULES_HUG_mapping.yaml
 
 ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-02
 ì£¼ì˜: ë³¸ ë¬¸ì„œëŠ” ë‚´ë¶€ ê·œì • ë¬¸ì„œ(ì„¹ì…˜/í‚¤) ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë©ë‹ˆë‹¤. êµ¬ì²´ ì„ê³„ê°’Â·ì˜ˆì™¸ëŠ” ë‚´ë¶€ ë¬¸ì„œ ê°’ìœ¼ë¡œë§Œ ì±„ì›ë‹ˆë‹¤(ì™¸ë¶€ ë§í¬ ë¯¸ì‚¬ìš©).
diff --git a/docs/docs/SCREEN_SPECS.md b/docs/docs/SCREEN_SPECS.md
index d689e72..2a7ef07 100644
--- a/docs/docs/SCREEN_SPECS.md
+++ b/docs/docs/SCREEN_SPECS.md
@@ -1,4 +1,5 @@
 # SCREEN_SPECS â€” í™”ë©´ë³„ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬/í”„ë¡­/ìƒíƒœ ì‚¬ì–‘
+Status: canonical (Screen Specs)
 
 ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-02
 
diff --git a/docs/docs/UI_UX_GUIDE.md b/docs/docs/UI_UX_GUIDE.md
index d9d498b..105abc5 100644
--- a/docs/docs/UI_UX_GUIDE.md
+++ b/docs/docs/UI_UX_GUIDE.md
@@ -1,4 +1,5 @@
 # UI_UX_GUIDE â€” UI/UX ìš°ì„  ì„¤ê³„ ê°€ì´ë“œ
+Status: canonical (UX Principles)
 
 ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-02
 
@@ -14,8 +15,8 @@
 
 ## IA/ë„¤ë¹„ê²Œì´ì…˜
 - ê¸°ë³¸ ì§„ì…: Conversation(ëŒ€í™”) í™”ë©´
-- ë³´ì¡°: History(íˆìŠ¤í† ë¦¬), DocsChecklist(ì²´í¬ë¦¬ìŠ¤íŠ¸), Settings(ì„¤ì •)
-- í•˜ë‹¨ íƒ­ ìƒëµ, AppBar ì•¡ì…˜/CTAë¡œ ì´ë™
+- ë³´ì¡°: DocsChecklist(ì²´í¬ë¦¬ìŠ¤íŠ¸), History(íˆìŠ¤í† ë¦¬), Settings(ì„¤ì •)
+- í•˜ë‹¨ íƒ­: 4-íƒ­(ì‹œì‘/ì²´í¬ë¦¬ìŠ¤íŠ¸/íˆìŠ¤í† ë¦¬/ì„¤ì •). AppBar ì•¡ì…˜/CTAëŠ” ë³´ì¡° ì´ë™
 
 ## í™”ë©´ êµ¬ì„± ìš”ì†Œ
 - ChatBubble(role: user|bot, citations[]): ì¸ìš© ì¹©ì€ ë¬¸ì„œID/ì„¹ì…˜í‚¤, ë§í¬ ë¯¸ë…¸ì¶œ
@@ -60,4 +61,3 @@
 - ì»´í¬ë„ŒíŠ¸ ì‚¬ì–‘: COMPONENT_SPECS.md
 - ì¹´í”¼/í†¤: COPY_GUIDE.md, RESULT_CARD_COPY.md
 - ì œí’ˆ ìš”êµ¬ì‚¬í•­: PRD_v1.md
-
-- 
2.39.5 (Apple Git-154)


From 6183cbe91d177b81f74525a902007e4ef167190b Mon Sep 17 00:00:00 2001
From: codex <codex@example.com>
Date: Wed, 3 Sep 2025 13:43:24 +0900
Subject: [PATCH 04/13] docs(ia): condense PRODUCT_BRIEF, move dir guidance to
 ARCHITECTURE, standardize last_verified single-source and update policies

---
 docs/docs/FLUTTER_DESIGN_SYSTEM.md |   9 ++-
 docs/docs/OPERATIONS_RUNBOOK.md    |   4 +-
 docs/docs/PRD_v1.md                |   2 +-
 docs/docs/PRODUCT_BRIEF.md         | 100 ++++++++---------------------
 docs/docs/RAG_POLICY.md            |   2 +-
 5 files changed, 33 insertions(+), 84 deletions(-)

diff --git a/docs/docs/FLUTTER_DESIGN_SYSTEM.md b/docs/docs/FLUTTER_DESIGN_SYSTEM.md
index e268a62..068bbb5 100644
--- a/docs/docs/FLUTTER_DESIGN_SYSTEM.md
+++ b/docs/docs/FLUTTER_DESIGN_SYSTEM.md
@@ -8,13 +8,12 @@ Status: derived (Implementation guide). Canonical: DESIGN_TOKENS.yaml, COMPONENT
 - Figma ì—†ì´ë„ Flutterì—ì„œ ì¼ê´€ëœ UIë¥¼ ë¹ ë¥´ê²Œ êµ¬í˜„í•˜ë„ë¡ í‘œì¤€ì„ ì œê³µí•©ë‹ˆë‹¤.
 - ë¬¸ì„œ-ì½”ë“œ ê°„ ì¼ì¹˜: í† í°(YAML) â†’ Dart Theme í™•ì¥ìœ¼ë¡œ ìë™/ë°˜ìë™ ë§¤í•‘.
 
-## ë””ë ‰í„°ë¦¬ ê¶Œì¥
-- `lib/ui/theme/` í…Œë§ˆ/í† í° ë§¤í•‘ (AppTheme, ThemeExtensions)
-- `lib/ui/components/` ê³µìš© ìœ„ì ¯(ResultCard, IntakeQuestion, ChatBubble ë“±)
-- `lib/ui/foundation/` ë ˆì´ì•„ì›ƒÂ·íƒ€ì´í¬ í—¬í¼, A11y, Keys
+## ì°¸ê³ : ë””ë ‰í„°ë¦¬ êµ¬ì¡°
+- ì„¸ë¶€ êµ¬ì¡°/ê¶Œì¥ì€ ARCHITECTURE.md ë° AGENTS.md(Repository Guidelines)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
+- ë³¸ ë¬¸ì„œëŠ” UI êµ¬í˜„ ê´€ì ë§Œ ë‹¤ë£¨ë©°, í´ë” êµ¬ì¡° ê²°ì •ì€ ì•„í‚¤í…ì²˜ ë¬¸ì„œì˜ í‘œì¤€ì„ ë”°ë¦…ë‹ˆë‹¤.
 
 ## ë””ìì¸ í† í°(ì†ŒìŠ¤)
-- íŒŒì¼: `docs/DESIGN_TOKENS.yaml` (ìƒ‰/íƒ€ì…/ìŠ¤í˜ì´ì‹±/ë¼ìš´ë“œ/ì‰ë„ìš°)
+- íŒŒì¼: `DESIGN_TOKENS.yaml` (ìƒ‰/íƒ€ì…/ìŠ¤í˜ì´ì‹±/ë¼ìš´ë“œ/ì‰ë„ìš°)
 - ë³€í™˜: ìˆ˜ë™/ìŠ¤í¬ë¦½íŠ¸ë¡œ Dart `ThemeExtension`ì— ì£¼ì…
 
 ## Theme êµ¬ì„± ì›ì¹™
diff --git a/docs/docs/OPERATIONS_RUNBOOK.md b/docs/docs/OPERATIONS_RUNBOOK.md
index cce501e..d946110 100644
--- a/docs/docs/OPERATIONS_RUNBOOK.md
+++ b/docs/docs/OPERATIONS_RUNBOOK.md
@@ -7,7 +7,7 @@ Status: canonical (Operations)
 1. ì†ŒìŠ¤ í™•ì¸: ë‚´ë¶€ ë¬¸ì„œ ê°œì •(ê°œì •ì¼/ë²„ì „) ìˆ˜ì‹ 
 2. ë§¤í•‘ ì—…ë°ì´íŠ¸: docs/RULES_HUG_mapping.yaml ì„¹ì…˜/ì„ê³„ê°’ ìˆ˜ì •
 3. ê²€í† : ë³€ê²½ í¬ì¸íŠ¸ ìš”ì•½ â†’ ì¹´í”¼ ì˜í–¥ ì ê²€(COPY_GUIDE, RESULT_CARD_COPY)
-4. last_verified ê°±ì‹ : PRODUCT_BRIEF.md/ê´€ë ¨ ë¬¸ì„œ ì¼ê´„ ì—…ë°ì´íŠ¸
+4. last_verified ê°±ì‹ : ë‹¨ì¼ ì†ŒìŠ¤ëŠ” RULES_HUG_mapping.yaml.last_verified. ë‹¤ë¥¸ ë¬¸ì„œëŠ” ê°±ì‹  ì•Œë¦¼ë§Œ(ë¬¸ì„œ ë©”íƒ€ â€˜ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸â€™ì™€ êµ¬ë¶„)
 5. QA: ì‹œë‚˜ë¦¬ì˜¤ 20ê°œ íšŒê·€ í…ŒìŠ¤íŠ¸ â†’ ìŠ¹ì¸
 
 ## 2) ê¸´ê¸‰ í•«í”½ìŠ¤(ì •ì±… ë³€ê²½/ì˜¤ë¥˜)
@@ -34,7 +34,7 @@ Status: canonical (Operations)
 - ê´‘ê³  ì •ì±… ì¤€ìˆ˜(ADS_POLICY)
 
 ## 6) ë¬¸ì„œ ë²„ì „ ê´€ë¦¬
-- RULES_HUG_v1.md / RULES_HUG_mapping.yaml: version í•„ë“œ, ë³€ê²½ ì´ë ¥ ìœ ì§€
+- RULES_HUG_v1.md / RULES_HUG_mapping.yaml: version, last_verified(ë‹¨ì¼ ì†ŒìŠ¤) í•„ë“œ, ë³€ê²½ ì´ë ¥ ìœ ì§€
 - PRODUCT_BRIEF.md/PRD_v1.md: ì£¼ìš” ê²°ì • ë³€ê²½ ì‹œ ì—…ë°ì´íŠ¸
 
 ## ë³€ê²½ ì´ë ¥
diff --git a/docs/docs/PRD_v1.md b/docs/docs/PRD_v1.md
index fe267e5..a5cccca 100644
--- a/docs/docs/PRD_v1.md
+++ b/docs/docs/PRD_v1.md
@@ -26,7 +26,7 @@ Status: canonical (Product Requirements)
 - RQ1 íŒì • í”Œë¡œìš°: 10~12ë¬¸ ê¸°ë³¸(ë¶„ê¸° ìµœëŒ€ 14). ê° ì§ˆë¬¸ì€ ì˜µì…˜ì— â€˜ëª¨ë¦„â€™ í¬í•¨.
 - RQ2 íŒì • ê²°ê³¼: ê°€ëŠ¥ / ë¶ˆê°€(ì •ë³´ ë¶€ì¡± í¬í•¨). TL;DR 2â€“3ì¤„, ì‚¬ìœ  ëª©ë¡(ì¶©ì¡±/ë¯¸ì¶©ì¡±/í™•ì¸ë¶ˆê°€), ë‹¤ìŒ ë‹¨ê³„(ì²´í¬ë¦¬ìŠ¤íŠ¸Â·í™•ì¸ ë°©ë²•), ë§ˆì§€ë§‰ í™•ì¸ì¼.
 - RQ3 Q&A: ììœ  ì§ˆë¬¸ì— ì‹¤ìš© ìš”ì•½ìœ¼ë¡œ ë‹µë³€. ë‚´ë¶€ ë¬¸ì„œ ê¸°ì¤€, ì™¸ë¶€ ë§í¬ ë¯¸ë…¸ì¶œ.
-- RQ4 ì‹ ë¢°Â·ê³ ì§€: ê¸ˆìœµìë¬¸ ì•„ë‹˜ ê³ ì§€, ë¶ˆí™•ì‹¤ ì‹œ â€˜í™•ì¸ë¶ˆê°€â€™ ëª…ì‹œ.
+- RQ4 ì‹ ë¢°Â·ê³ ì§€: ê¸ˆìœµìë¬¸ ì•„ë‹˜ ê³ ì§€, ë¶ˆí™•ì‹¤ ì‹œ â€˜í™•ì¸ë¶ˆê°€â€™ ëª…ì‹œ. last_verifiedëŠ” RULES_HUG_mapping.yamlì˜ ê°’ì„ ë‹¨ì¼ ì†ŒìŠ¤ë¡œ ì‚¬ìš©.
 - RQ5 ê¸°ë¡ì„±: íŒì • ê²°ê³¼ì™€ ì‚¬ìš© ì‘ë‹µì„ ë¡œì»¬ì— ì„ì‹œ ì €ì¥(íˆìŠ¤í† ë¦¬Â·ì¬ì‹œë„).
 
 ## ë¹„ë²”ìœ„(ì´ë²ˆ ì œì™¸)
diff --git a/docs/docs/PRODUCT_BRIEF.md b/docs/docs/PRODUCT_BRIEF.md
index 953174f..9897e46 100644
--- a/docs/docs/PRODUCT_BRIEF.md
+++ b/docs/docs/PRODUCT_BRIEF.md
@@ -3,78 +3,28 @@ Status: derived (Executive summary). Canonical: PRD_v1.md
 
 ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-02
 
-## 1) ì œí’ˆ í•œì¤„ ì†Œê°œ
-ì „ì„¸ìê¸ˆëŒ€ì¶œ(HUG ìš°ì„ )ì˜ ìê²©(ë³¸ì¸Â·ëª©ì ë¬¼) ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ëŒ€í™”í˜• ì§ˆë¬¸ìœ¼ë¡œ ë¹ ë¥´ê²Œ íŒì •í•˜ê³ , ì´í›„ ê¶ê¸ˆí•œ ì‚¬í•­ì„ AI ì±—ë´‡ìœ¼ë¡œ ì´ì–´ì„œ ë‹µë³€í•˜ëŠ” ì•±.
-
-## 2) ë¬¸ì œ Â· íƒ€ê¹ƒ Â· JTBD
-- ë¬¸ì œ: ì „ì„¸ëŒ€ì¶œ ìê²© ìš”ê±´ì´ ë³µì¡í•˜ê³  í©ì–´ì ¸ ìˆì–´ ìŠ¤ìŠ¤ë¡œ íŒë‹¨ì´ ì–´ë µë‹¤.
-- íƒ€ê¹ƒ: ì „ì„¸/ì´ì‚¬/ê°±ì‹ /ê°ˆì•„íƒ€ê¸°ë¥¼ ì¤€ë¹„í•˜ëŠ” 20â€“40ëŒ€(ì „êµ­, ì£¼íƒ ìœ í˜• ì „ë²”ìœ„).
-- JTBD: â€œë‚´ ìƒí™©ê³¼ ì§‘ì´ ì¡°ê±´ì— ë§ëŠ”ì§€ ì¦‰ì‹œ ì•Œê³ , ë‹¤ìŒì— ë¬´ì—‡ì„ ì¤€ë¹„í• ì§€ ëª…í™•íˆ í•˜ê³  ì‹¶ë‹¤.â€
-
-## 3) í™•ì • ë²”ìœ„/ì •ì±…(ì˜ì‚¬ê²°ì • ìš”ì•½)
-- ê¸°ê´€ ë²”ìœ„: HUGë¥¼ ìš°ì„  ì ìš©(HF/SGIëŠ” í›„ì† ë„ì…).
-- ëª©ì ë¬¼/ì§€ì—­: ì „ ë²”ìœ„(ì•„íŒŒíŠ¸/ì˜¤í”¼ìŠ¤í…”/ë‹¤ê°€êµ¬/ì›ë£¸ ë“±, ì „êµ­).
-- íŒì • ì›ì¹™: ì–´ë–¤ ì§ˆë¬¸ì´ë“  í™•ì¸ ë¶ˆê°€í•œ í•­ëª©ì´ ìˆìœ¼ë©´ ìµœì¢… íŒì •ì€ â€œë¶ˆê°€(ì •ë³´ ë¶€ì¡±)â€ë¡œ ì²˜ë¦¬. UIì—ëŠ” í•´ë‹¹ í•­ëª©ì— â€œí™•ì¸ë¶ˆê°€â€ ë¼ë²¨ì„ ëª…ì‹œ.
-- ì‘ë‹µ í†¤: ì‹¤ìš© ìš”ì•½ ì¤‘ì‹¬(TL;DR â†’ ì´ìœ /ì˜ˆì™¸ â†’ ë‹¤ìŒ ë‹¨ê³„).
-- ì¶œì²˜/ê·¼ê±°: ì™¸ë¶€ ë§í¬ ë¹„ë…¸ì¶œ. ë‚´ë¶€ ë¬¸ì„œ ê¸°ë°˜ìœ¼ë¡œ ë‹µë³€(ë§ˆì§€ë§‰ í™•ì¸ì¼ì€ ë…¸ì¶œ).
-- ìˆ˜ìµí™”: ê´‘ê³  ëª¨ë¸ ê¸°ë°˜ ë¬´ë£Œ ì œê³µ(ì´ˆê¸° ë² íƒ€ ë‹¨ê³„).
-
-## 4) MVP ê¸°ëŠ¥
-- ìê²© ì˜ˆë¹„íŒì •: ëŒ€í™”í˜• ì§ˆë¬¸(10~12ë¬¸ ê¸°ë³¸, ìƒí™© ë¶„ê¸° ìµœëŒ€ 14)ìœ¼ë¡œ â€˜ê°€ëŠ¥/ë¶ˆê°€(ì •ë³´ ë¶€ì¡± í¬í•¨)â€™ ê²°ê³¼ ì œê³µ.
-- ê²°ê³¼ ì¹´ë“œ: TL;DR 3ì¤„ + ì‚¬ìœ (ì¶©ì¡±/ë¯¸ì¶©ì¡±/í™•ì¸ë¶ˆê°€ í•­ëª©ë³„) + ë‹¤ìŒ ë‹¨ê³„(ì¤€ë¹„ë¬¼Â·í™•ì¸ ë°©ë²•) + ë§ˆì§€ë§‰ í™•ì¸ì¼.
-- AI Q&A: í•œë„/ì„œë¥˜/ì ˆì°¨/ìš©ì–´ ë“± í›„ì† ì§ˆë¬¸ì„ ì´ì–´ì„œ ë‹µë³€.
-- â€˜ëª¨ë¦„â€™ ì²˜ë¦¬: ì¦‰ì‹œ ê²½ê³ (ë¶ˆê°€ë¡œ ê·€ê²°)ì™€ í•¨ê»˜ í™•ì¸ ë°©ë²• ì•ˆë‚´ ë²„íŠ¼ ì œê³µ.
-
-## 5) ëŒ€í™”í˜• ì¸í…Œì´í¬(ë¬¸í•­ ì´ˆì•ˆ)
-- ì‹ ì²­ì: ë¬´ì£¼íƒ/ì„¸ëŒ€ì£¼, í˜¼ì¸/ë¶€ì–‘, ì†Œë“ í˜•íƒœÂ·êµ¬ê°„, ì¬ì§/ì‚¬ì—… ê¸°ê°„, ê¸°ì¡´ ëŒ€ì¶œ/ë³´ì¦, ì—°ì²´/ì‹ ìš© ë¬¸ì œ(ìê°€ì‹ ê³ /ëª¨ë¦„).
-- ëª©ì ë¬¼: ì£¼íƒ ìœ í˜•, ì „ìš©ë©´ì , ì§€ì—­, ë³´ì¦ê¸ˆ(ë˜ëŠ” ë³´ì¦ê¸ˆ+ì›”ì„¸), ê³„ì•½ ìƒíƒœÂ·ì…ì£¼ ì˜ˆì •, ë“±ê¸°ìƒ ê·¼ì €ë‹¹ ìœ ë¬´(ëª¨ë¦„ í—ˆìš©).
-- ìš°ëŒ€/íŠ¹ë¡€: ì²­ë…„/ì‹ í˜¼/ë‹¤ìë…€/ì €ì†Œë“ ë“± í•´ë‹¹ ì—¬ë¶€.
-
-## 6) íŒì • ë¡œì§(ê°œìš”)
-- ê·œì¹™ ìš°ì„ ìˆœìœ„: ê²°ê²© ì‚¬ìœ (ì¦‰ì‹œ ë¶ˆê°€) â†’ í•„ìˆ˜ ì¶©ì¡± ìš”ê±´ â†’ ì¡°ê±´ í™•ì¸ í•„ìš” í•­ëª©.
-- ë¶ˆí™•ì‹¤ ê´€ë¦¬: ë‹¨ í•˜ë‚˜ë¼ë„ â€˜í™•ì¸ë¶ˆê°€â€™ê°€ ìˆìœ¼ë©´ ìµœì¢… ê²°ê³¼ëŠ” â€˜ë¶ˆê°€(ì •ë³´ ë¶€ì¡±)â€™. í•´ë‹¹ í•­ëª©ì—ëŠ” í™•ì¸ ë°©ë²•ì„ ì•ˆë‚´.
-- ë©”ì‹œì§€: ì‚¬ìš©ìê°€ ì´í•´í•˜ê¸° ì‰¬ìš´ ì‚¬ìœ  ìš”ì•½(ê·œì • ë¬¸êµ¬ ì¶•ì•½)ê³¼ ë‹¤ìŒ ë‹¨ê³„ ì œì‹œ.
-
-## 7) ê²°ê³¼ ì¹´ë“œ í¬ë§·(ì˜ˆì‹œ)
-- íŒì •: ê°€ëŠ¥ / ë¶ˆê°€(ì •ë³´ ë¶€ì¡± í¬í•¨)
-- TL;DR: 2â€“3ì¤„ ìš”ì•½
-- ì‚¬ìœ : ì¶©ì¡±/ë¯¸ì¶©ì¡±/í™•ì¸ë¶ˆê°€ í•­ëª© ëª©ë¡
-- ë‹¤ìŒ ë‹¨ê³„: ì¤€ë¹„ë¬¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ + í™•ì¸ ë°©ë²•(ë“±ê¸°/í™•ì •ì¼ì ë“±)
-- ë©”íƒ€: ë§ˆì§€ë§‰ í™•ì¸ì¼(YYYY-MM-DD), ë‚´ë¶€ ê·œì • ë²„ì „
-
-## 8) ì±—ë´‡ í”Œë¡œìš°(ìš”ì•½)
-- í™ˆ: â€œì˜ˆë¹„ìê²© ë¹ ë¥¸ íŒì •â€ ì‹œì‘ â†’ ì§„í–‰ ë°” í‘œì‹œ
-- íŒì •: ê²°ê³¼ ì¹´ë“œ ë…¸ì¶œ â†’ í›„ì† ì œì•ˆ(í•œë„ ì¶”ì •/ì„œë¥˜ ì•ˆë‚´/ìœ ì‚¬ ì‚¬ë¡€)
-- Q&A: ììœ  ì§ˆì˜ ì‘ë‹µ, ì‹¤ìš© ìš”ì•½ í†¤ ìœ ì§€(ë‚´ë¶€ ë¬¸ì„œ ê·¼ê±° ê¸°ë°˜)
-
-## 9) KPI(ì´ˆì•ˆ)
-- í¼ë„: íŒì • ì™„ì£¼ìœ¨, íŒì •ê¹Œì§€ í‰ê·  ì‹œê°„
-- í’ˆì§ˆ: ë§Œì¡±ë„(ğŸ‘), â€œì‚¬ìœ  ë³´ê¸°â€ í´ë¦­ë¥ , ì •ì • ìš”ì²­ë¥ 
-- ë¦¬í…ì…˜: í›„ì† Q&A ì§„ì…ë¥ , D1/D7 ì¬ë°©ë¬¸
-
-## 10) ë¦¬ìŠ¤í¬ Â· ëŒ€ì‘
-- ì •ë³´ ë¶€ì¡±ìœ¼ë¡œ ì¸í•œ â€˜ë¶ˆê°€â€™ ë¹ˆë„ ìƒìŠ¹: í™•ì¸ ë°©ë²•ì„ ì¦‰ì‹œ ì œì‹œí•´ ì¬ì‹œë„ ìœ ë„.
-- ìµœì‹ ì„±: ë‚´ë¶€ ë¬¸ì„œ ê°±ì‹  ë£¨í‹´ ìš´ì˜, í™”ë©´ì— ë§ˆì§€ë§‰ í™•ì¸ì¼ ìƒì‹œ í‘œê¸°.
-- ë²”ìœ„ í™•ì¥ ë¦¬ìŠ¤í¬: HUGë¡œ ì•ˆì •í™” í›„ HF/SGI ìˆœì°¨ ì ìš©(ê·œì¹™ ëª¨ë“ˆí™”).
-
-## 11) ë¡œë“œë§µ(ìš”ì•½)
-- ì•ŒíŒŒ(2ì£¼): HUG í•µì‹¬ ê·œì¹™ v1, ì¸í…Œì´í¬/ê²°ì • íŠ¸ë¦¬, ê²°ê³¼ ì¹´ë“œ, Q&A ê¸°ë³¸.
-- ë² íƒ€(4ì£¼): íŠ¹ë¡€Â·ì˜ˆì™¸ í™•ëŒ€, ë¬¸êµ¬ í’ˆì§ˆ ê°œì„ , ê´‘ê³  ìŠ¬ë¡¯ ë„ì…, KPIÂ·í”¼ë“œë°± ìˆ˜ì§‘.
-- GA: ë¹ˆë„ ë†’ì€ ì§ˆë¬¸ ê°•í™”, ì˜¨ë³´ë”©/ì¹´í”¼ ê°œì„ , ì•ˆì •í™”.
-
-## 12) ë‹¤ìŒ ë‹¨ê³„(Action Items)
-- PRD v1 ì‘ì„±: ìê²© ê·œì¹™ ë²”ì£¼Â·ê²°ê²© ì‚¬ìœ Â·ë©”ì‹œì§€ ì‚¬ì „.
-- ì¸í…Œì´í¬ ìŠ¤í¬ë¦½íŠ¸ v1: ë¬¸í•­Â·ë¶„ê¸°Â·ëª¨ë¦„ ëŒ€ì‘Â·í™•ì¸ ë°©ë²• ë¬¸ì•ˆ.
-- ê·œì¹™ ì—”ì§„ ìŠ¤í™: ìš°ì„ ìˆœìœ„/í‰ê°€ ìˆœì„œ/ë©”ì‹œì§€ ë§¤í•‘/ë²„ì „ ê´€ë¦¬.
-- ê²°ê³¼ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ ì‚¬ì–‘: TL;DR/ì‚¬ìœ /ë‹¤ìŒ ë‹¨ê³„/ë©”íƒ€.
-- ê´‘ê³  ë°°ì¹˜ ê°€ì´ë“œ: ê²°ê³¼ í•˜ë‹¨ ë¹„ê°„ì„­í˜• ìš°ì„ .
-
-## 13) ì§„í–‰ ê¸°ë¡(ìš”ì•½)
-- 1ì°¨ í•©ì˜: â€œìê²©(ë³¸ì¸Â·ëª©ì ë¬¼) íŒë³„ + AI Q&Aâ€ë¡œ ì´ˆì  ì„¤ì •.
-- ì •ì±… í™•ì •: HUG ìš°ì„ , ì „ ë²”ìœ„ ëŒ€ìƒ, â€˜í™•ì¸ë¶ˆê°€=ë¶ˆê°€â€™, ì‹¤ìš© ìš”ì•½ í†¤, ì™¸ë¶€ ë§í¬ ë¯¸ì‚¬ìš©, ë§ˆì§€ë§‰ í™•ì¸ì¼ ë…¸ì¶œ, ê´‘ê³  ëª¨ë¸.
-- ì‚°ì¶œë¬¼: PROJECT.md(ê¸°íš TODO) ì •ë¦¬, ë³¸ ë¬¸ì„œ(PRODUCT_BRIEF.md)ë¡œ í•µì‹¬ ìš”ì•½ ê³ ì •.
-
-## 14) ë³€ê²½ ì´ë ¥
-- 2025-09-02: ì´ˆê¸° ë²„ì „ ì‘ì„±(í•µì‹¬ ê²°ì •ê³¼ í”„ë¡œì„¸ìŠ¤ ê¸°ë¡).
-
-> ë¹„ê³ : ê°œë°œ ì•„í‚¤í…ì²˜/êµ¬í˜„ ì„¸ë¶€ëŠ” ë³„ë„ ARCHITECTURE.mdì—ì„œ ë‹¤ë£¹ë‹ˆë‹¤(ê¸°íš ë¬¸ì„œì™€ ë¶„ë¦¬).
+## í•œì¤„ ì†Œê°œ
+ì „ì„¸ìê¸ˆëŒ€ì¶œ(HUG ìš°ì„ ) ìê²©(ë³¸ì¸Â·ëª©ì ë¬¼)ì„ ë¹ ë¥´ê²Œ íŒì •í•˜ê³ , ì´í›„ í•œë„/ì„œë¥˜/ì ˆì°¨ë¥¼ AI ì±—ë´‡ìœ¼ë¡œ ì•ˆë‚´í•˜ëŠ” ì•±.
+
+## í•µì‹¬ ìš”ì•½
+- ë¬¸ì œ/íƒ€ê¹ƒ/JTBD: ë³µì¡í•œ ìê²© ìš”ê±´ì„ 20â€“40ëŒ€ ì‹¤ìˆ˜ ì—†ì´ ë¹ ë¥´ê²Œ í™•ì¸. â€œë‚´ ìƒí™©Â·ì§‘ì´ ì¡°ê±´ì— ë§ëŠ”ì§€ ì¦‰ì‹œ ì•Œê³ , ë‹¤ìŒ ì¤€ë¹„ë¥¼ ëª…í™•íˆ.â€
+- ì •ì±…: ë‚´ë¶€ ë¬¸ì„œë§Œ ê·¼ê±°, ì™¸ë¶€ ë§í¬ ë¯¸ë…¸ì¶œ. â€˜ëª¨ë¦„â€™ í•˜ë‚˜ë¼ë„ í¬í•¨ ì‹œ ìµœì¢… â€˜ë¶ˆê°€(ì •ë³´ ë¶€ì¡±)â€™. ë§ˆì§€ë§‰ í™•ì¸ì¼(last_verified) ë…¸ì¶œ.
+- ë²”ìœ„: HUG ìš°ì„ (ì „êµ­/ì£¼íƒ ìœ í˜• ì „ë°˜). HF/SGIëŠ” í›„ì†.
+- ìˆ˜ìµí™”: ë¹„ê°„ì„­í˜• ê´‘ê³ (ê²°ê³¼/ì±— í•˜ë‹¨, â€˜ê´‘ê³ â€™ ë¼ë²¨).
+
+## MVP ìŠ¤ëƒ…ìƒ·
+- ì¸í…Œì´í¬(10~12ë¬¸, ë¶„ê¸° ìµœëŒ€ 14, â€˜ëª¨ë¦„â€™ í¬í•¨) â†’ ê²°ê³¼ ì¹´ë“œ(TL;DR/ì‚¬ìœ /ë‹¤ìŒ ë‹¨ê³„/last_verified) â†’ Q&A.
+- ì¶”ì²œ: í•œë„ ì¶”ì •/ì„œë¥˜ ì²´í¬ë¦¬ìŠ¤íŠ¸/í™•ì¸ ë°©ë²•.
+
+## KPI(í•µì‹¬)
+- ì™„ì£¼ìœ¨ â‰¥ 70%, ìµœì´ˆ íŒì • â‰¤ 90ì´ˆ, Q&A ì§„ì… â‰¥ 50%, ë§Œì¡±ë„(ğŸ‘) â‰¥ 70%.
+
+## ì°¸ê³  ë¬¸ì„œ
+- ìš”êµ¬ì‚¬í•­: PRD_v1.md
+- ì¸í…Œì´í¬: INTAKE_FLOW.md
+- ê·œì¹™/ë§¤í•‘: RULES_HUG_v1.md, RULES_HUG_mapping.yaml
+- UX/í™”ë©´: UI_UX_GUIDE.md, APP_SCREEN_PLAN.md, SCREEN_SPECS.md
+- ì»´í¬ë„ŒíŠ¸/í† í°: COMPONENT_SPECS.md, UI_BLUEPRINT.yaml, DESIGN_TOKENS.yaml
+- ì¸¡ì •/ìš´ì˜/ë²•Â·ê´‘ê³ : MEASUREMENT_PLAN.md, OPERATIONS_RUNBOOK.md, LEGAL_CHECKLIST.md, ADS_POLICY.md
+
+> ìƒì„¸ ìŠ¤í™Â·ìˆ˜ìš©ê¸°ì¤€Â·ì—£ì§€ì¼€ì´ìŠ¤ëŠ” PRD_v1.mdì—ì„œ ìœ ì§€í•˜ë©°, ë³¸ ë¬¸ì„œëŠ” ì˜ì‚¬ê²°ì •Â·í•µì‹¬ ë²”ìœ„ë§Œ ìš”ì•½í•©ë‹ˆë‹¤.
diff --git a/docs/docs/RAG_POLICY.md b/docs/docs/RAG_POLICY.md
index d699975..799668a 100644
--- a/docs/docs/RAG_POLICY.md
+++ b/docs/docs/RAG_POLICY.md
@@ -26,7 +26,7 @@ Status: canonical (RAG Policy)
 - íšŒìƒ‰ì§€ëŒ€: ìƒì¶©/ë¹„ë¬¸ ì¼ì¹˜ ì‹œ ë³´ìˆ˜ì ìœ¼ë¡œ â€˜í™•ì¸ë¶ˆê°€â€™.
 
 ## ìµœì‹ ì„± ê·œì¹™
-- ê¸°ì¤€: docs/RULES_HUG_mapping.yaml ì˜ last_verified ì‚¬ìš©.
+- ë‹¨ì¼ ì†ŒìŠ¤: RULES_HUG_mapping.yaml ì˜ last_verified ì‚¬ìš©(ì•±/UI í‘œì‹œëŠ” ì´ ê°’ì„ ê·¸ëŒ€ë¡œ ì°¸ì¡°).
 - ì„ê³„: 30ì¼ ì´ˆê³¼ ì‹œ â€˜ì •ë³´ ìµœì‹ ì„± í™•ì¸ í•„ìš”â€™ ë°°ì§€ ë…¸ì¶œ.
 
 ## í…”ë ˆë©”íŠ¸ë¦¬(ì¸¡ì • ì—°ê³„)
-- 
2.39.5 (Apple Git-154)


From 3aeb0c8eb5b56e5b29e9c0226b16a562eb1c173c Mon Sep 17 00:00:00 2001
From: codex <codex@example.com>
Date: Wed, 3 Sep 2025 13:46:20 +0900
Subject: [PATCH 05/13] docs(docs): add CONTRIBUTING_DOCS, index link, and app
 integration TODOs; refine PROJECT automation tasks

---
 docs/docs/CONTRIBUTING_DOCS.md  | 33 +++++++++++++++++++++++++++++++++
 docs/docs/DOCS_INDEX.md         |  3 +++
 docs/docs/OPERATIONS_RUNBOOK.md |  6 ++++++
 docs/docs/PROJECT.md            |  5 +++++
 4 files changed, 47 insertions(+)
 create mode 100644 docs/docs/CONTRIBUTING_DOCS.md

diff --git a/docs/docs/CONTRIBUTING_DOCS.md b/docs/docs/CONTRIBUTING_DOCS.md
new file mode 100644
index 0000000..db04b85
--- /dev/null
+++ b/docs/docs/CONTRIBUTING_DOCS.md
@@ -0,0 +1,33 @@
+# CONTRIBUTING_DOCS â€” ë¬¸ì„œ ì‘ì„±/ìœ ì§€ ê·œì•½
+Status: canonical (Docs Conventions)
+
+ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-09-03
+
+## Canonical vs. Derived
+- canonical: ì‚¬ì‹¤/ìš”êµ¬ì‚¬í•­ì˜ ë‹¨ì¼ ì¶œì²˜. íŒŒìƒ ë¬¸ì„œê°€ ë‚´ìš©ì„ ì¬ì •ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
+- derived: ìš”ì•½/ê°€ì´ë“œ/ì˜ˆì‹œ. ìƒì„¸Â·ì •í•©ì„±ì€ í•­ìƒ canonicalì„ ìš°ì„ í•©ë‹ˆë‹¤.
+
+## ë‹¨ì¼ ì†ŒìŠ¤ ê·œì¹™
+- last_verified: RULES_HUG_mapping.yamlì˜ ê°’ì„ ë‹¨ì¼ ì†ŒìŠ¤ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
+- ê·œì¹™/ì„ê³„ê°’: RULES_HUG_mapping.yaml â†’ RULES_HUG_v1.md ìˆœìœ¼ë¡œ ì°¸ì¡°í•©ë‹ˆë‹¤.
+
+## ì°¸ì¡° í‘œê¸°
+- docs ë‚´ë¶€ ë¬¸ì„œ ê°„ì—ëŠ” íŒŒì¼ëª…ë§Œ ê¸°ì¬í•©ë‹ˆë‹¤(ì˜ˆ: DESIGN_TOKENS.yaml).
+- ë£¨íŠ¸ README ë“± ì™¸ë¶€ ì§„ì…ì ì—ì„œëŠ” ê²½ë¡œë¥¼ í¬í•¨í•©ë‹ˆë‹¤(ì˜ˆ: docs/docs/PRD_v1.md).
+- ì™¸ë¶€ ë§í¬/ê²€ìƒ‰ì€ ê¸ˆì§€í•©ë‹ˆë‹¤(RAG_POLICY).
+
+## ë³€ê²½ ì›ì¹™
+- ì¤‘ë³µ/ìƒì¶© ë°œê²¬ ì‹œ: canonicalì—ë§Œ ë‚´ìš©ì„ ìœ ì§€í•˜ê³ , derivedì—ëŠ” ìš”ì•½/ë§í¬ë§Œ ë‚¨ê¹ë‹ˆë‹¤.
+- Status í—¤ë” ìœ ì§€: ë¬¸ì„œ ìƒë‹¨ì— Statusë¥¼ í‘œê¸°í•©ë‹ˆë‹¤.
+- ë„¤ë¹„ê²Œì´ì…˜: í•˜ë‹¨ 4-íƒ­(ì‹œì‘/ì²´í¬ë¦¬ìŠ¤íŠ¸/íˆìŠ¤í† ë¦¬/ì„¤ì •)ì„ ê¸°ì¤€ìœ¼ë¡œ ë¬¸ì„œë¥¼ ì¼ê´€ë˜ê²Œ ê¸°ìˆ í•©ë‹ˆë‹¤.
+
+## ì»¤ë°‹ ê·œì¹™(ë¬¸ì„œ)
+- Conventional Commits: docs(scope): summary
+- ì˜ˆ: docs(ia): update index, mark canonical; docs(rules): refresh last_verified
+
+## ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸
+- [ ] Status í—¤ë” ì¡´ì¬(canonical/derived)
+- [ ] last_verified ì°¸ì¡°ê°€ ë‹¨ì¼ ì†ŒìŠ¤ ê·œì¹™ê³¼ ì¼ì¹˜
+- [ ] íŒŒì¼ëª…/ê²½ë¡œ í‘œê¸°ê°€ ë³¸ ê·œì•½ê³¼ ì¼ì¹˜
+- [ ] ì¤‘ë³µ/ìƒì¶© ë¬¸êµ¬ ì œê±° ë˜ëŠ” canonicalë¡œ ì§‘ì•½
+
diff --git a/docs/docs/DOCS_INDEX.md b/docs/docs/DOCS_INDEX.md
index b984abf..59979f9 100644
--- a/docs/docs/DOCS_INDEX.md
+++ b/docs/docs/DOCS_INDEX.md
@@ -23,6 +23,9 @@ Status: canonical (Information Architecture)
 - Operations: OPERATIONS_RUNBOOK.md, Release: RELEASE_PLAN.md
 - Legal/Ads: LEGAL_CHECKLIST.md, ADS_POLICY.md
 
+## Contributing
+- ë¬¸ì„œ ì‘ì„±/ìœ ì§€ ê·œì•½ì€ CONTRIBUTING_DOCS.mdë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
+
 ## ì—°ê´€ì„±(ìš”ì•½)
 - PRD_v1.md â†’ í™”ë©´/ì»´í¬ë„ŒíŠ¸ì˜ ìˆ˜ìš©ê¸°ì¤€ê³¼ ì½˜í…ì¸  ë²”ìœ„ ì •ì˜
 - RULES_HUG_v1.md â†’ ê²°ê³¼ ì¹´ë“œ ìƒíƒœ/ì‚¬ìœ /â€˜ëª¨ë¦„â€™ ì²˜ë¦¬ ê·œì •ì˜ ê·¼ê±°
diff --git a/docs/docs/OPERATIONS_RUNBOOK.md b/docs/docs/OPERATIONS_RUNBOOK.md
index d946110..358ffbe 100644
--- a/docs/docs/OPERATIONS_RUNBOOK.md
+++ b/docs/docs/OPERATIONS_RUNBOOK.md
@@ -37,5 +37,11 @@ Status: canonical (Operations)
 - RULES_HUG_v1.md / RULES_HUG_mapping.yaml: version, last_verified(ë‹¨ì¼ ì†ŒìŠ¤) í•„ë“œ, ë³€ê²½ ì´ë ¥ ìœ ì§€
 - PRODUCT_BRIEF.md/PRD_v1.md: ì£¼ìš” ê²°ì • ë³€ê²½ ì‹œ ì—…ë°ì´íŠ¸
 
+## 7) ì•± ì—°ë™ TODO
+- last_verified ì£¼ì…: ì•±ì€ RULES_HUG_mapping.yaml.last_verifiedë¥¼ êµ¬ì„± ê°ì²´ë¡œ ì£¼ì…ë°›ë„ë¡ í•©ë‹ˆë‹¤.
+  - ì œì•ˆ: ë¹Œë“œ ë‹¨ê³„ì—ì„œ YAMLâ†’Dart const ë³€í™˜ ìŠ¤í… ìƒì„±(`lib/common/config/rules_meta.dart`).
+  - ëŒ€ì•ˆ: ëŸ°íƒ€ì„ì— assetsë¡œ ë¡œë”©(ì´ˆê¸° MVPëŠ” ìƒìˆ˜ ì£¼ì… ê¶Œì¥).
+- ê·œì¹™ ì—”ì§„ ì—°ê²°: í‰ê°€ ëª¨ë“ˆì´ mapping.yamlì„ í•´ì„í•˜ëŠ” ì–´ëŒ‘í„°ë¥¼ í†µí•´ ê²½ê³ /ê²°ê²©/í•„ìˆ˜ í•„ë“œë¥¼ ì£¼ì…ë°›ë„ë¡ ìŠ¤ì¼ˆë ˆí†¤ ì‘ì„±.
+
 ## ë³€ê²½ ì´ë ¥
 - 2025-09-02: ì´ˆê¸° ì‘ì„±.
diff --git a/docs/docs/PROJECT.md b/docs/docs/PROJECT.md
index 7a1355f..77645e7 100644
--- a/docs/docs/PROJECT.md
+++ b/docs/docs/PROJECT.md
@@ -96,6 +96,11 @@
 4) í•µì‹¬ UX íë¦„Â·ì™€ì´ì–´í”„ë ˆì„ ì´ˆì•ˆ
 5) PRD v1 + ë¦´ë¦¬ìŠ¤ ë§ˆì¼ìŠ¤í†¤ ì •ì˜
 
+## ìë™í™”/ì—°ë™ TODO
+- [ ] last_verified ìë™ ì£¼ì…: RULES_HUG_mapping.yaml â†’ Dart const ìƒì„± ìŠ¤í…(ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸) â†’ UI í‘œê¸° ì¼ì›í™”
+- [ ] ê·œì¹™ ì—”ì§„ ìŠ¤ì¼ˆë ˆí†¤: mapping.yaml í•´ì„ ì–´ëŒ‘í„° + í‰ê°€ ìˆœì„œ(C1â†’C2â†’C3) í‹€ ìƒì„±
+- [ ] ë¬¸ì„œ ê·œì•½ ì¤€ìˆ˜ ì²´í¬: CONTRIBUTING_DOCS.md ì²´í¬ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ pre-commit ìŠ¤í¬ë¦½íŠ¸(ì„ íƒ)
+
 ## Kickoff ì§ˆë¬¸(ê°€ì´ë“œ)
 - íƒ€ê¹ƒ ìœ ì €Â·í•µì‹¬ ë¬¸ì œ: ëˆ„êµ¬ì˜ ì–´ë–¤ ì¼ì„ ë•ë‚˜ìš”?
 - ì„±ê³µì§€í‘œ: 1ì°¨Â·ë³´ì¡° KPIëŠ”? ì–¸ì œ ì„±ê³µì´ë¼ ë§í•˜ë‚˜ìš”?
-- 
2.39.5 (Apple Git-154)


From 7939113ad369783e38478ab720132f99df1dc608 Mon Sep 17 00:00:00 2001
From: codex <codex@example.com>
Date: Wed, 3 Sep 2025 14:01:18 +0900
Subject: [PATCH 06/13] docs(ui): correct Flutter UI guidance (M3 breakpoints,
 48dp touch targets, directional padding, ink effects, nested scroll guidance)

---
 docs/docs/COMPONENT_SPECS.md       |  4 +++-
 docs/docs/FLUTTER_DESIGN_SYSTEM.md | 17 ++++++++++++-----
 docs/docs/SCREEN_SPECS.md          |  6 ++++++
 docs/docs/UI_UX_GUIDE.md           |  3 +++
 4 files changed, 24 insertions(+), 6 deletions(-)

diff --git a/docs/docs/COMPONENT_SPECS.md b/docs/docs/COMPONENT_SPECS.md
index 367d2bf..f38bee6 100644
--- a/docs/docs/COMPONENT_SPECS.md
+++ b/docs/docs/COMPONENT_SPECS.md
@@ -122,10 +122,12 @@ class AdSlot extends StatelessWidget {
 
 ## Buttons/Chips
 - ElevatedButton/OutlinedButton/TextButtonì„ ì‚¬ìš©, ìŠ¤íƒ€ì¼ì€ Themeì—ì„œ ì¼ê´„ ì§€ì •
-- ChoiceChip: ì„ íƒ/ë¹„ì„ íƒ ëŒ€ë¹„ í™•ë³´, ìµœì†Œ í­ 44dp
+- ChoiceChip: ì„ íƒ/ë¹„ì„ íƒ ëŒ€ë¹„ í™•ë³´, ìµœì†Œ í„°ì¹˜ íƒ€ê²Ÿ 48Ã—48dp ë³´ì¥(íŒ¨ë”©/heightë¡œ í™•ë³´)
+- ì‰í¬ íš¨ê³¼ ìœ ì§€: ë²„íŠ¼/ì¹© ìƒí˜¸ì‘ìš©ì€ í‘œì¤€ ë¨¸í‹°ë¦¬ì–¼ ìœ„ì ¯ ì‚¬ìš©(ì»¤ìŠ¤í…€ ì œìŠ¤ì²˜ë¡œ ëŒ€ì²´ ì§€ì–‘)
 
 ## ë¦¬ìŠ¤íŠ¸/ìŠ¤í¬ë¡¤
 - Reasons/NextStepsëŠ” `ListView.separated` ë˜ëŠ” `Column`+`SizedBox(height: spacing)`
+- ìŠ¤í¬ë¡¤ ì¤‘ì²© ì§€ì–‘: ìŠ¤í¬ë¡¤ëŸ¬ ì•ˆì—ëŠ” Sliver ê³„ì—´ ë˜ëŠ” ë‹¨ì¼ ìŠ¤í¬ë¡¤ë§Œ ìœ ì§€(shrinkWrap ê³¼ë„ ì‚¬ìš© ê¸ˆì§€)
 
 ## Keys(í…ŒìŠ¤íŠ¸ ì‹ë³„ì)
 - ResultCard: `Key('ResultCard.TLDR')`, `Key('ResultCard.Reasons')`, `Key('ResultCard.Next')`
diff --git a/docs/docs/FLUTTER_DESIGN_SYSTEM.md b/docs/docs/FLUTTER_DESIGN_SYSTEM.md
index 068bbb5..e60d795 100644
--- a/docs/docs/FLUTTER_DESIGN_SYSTEM.md
+++ b/docs/docs/FLUTTER_DESIGN_SYSTEM.md
@@ -73,9 +73,11 @@ ThemeData buildAppTheme(Brightness brightness) {
 ```
 
 ## ë°˜ì‘í˜•/ë ˆì´ì•„ì›ƒ ê·œì¹™
-- 8pt ê·¸ë¦¬ë“œ, ê¸°ë³¸ íŒ¨ë”© `theme.extension<Spacing>()!.x4` ì‚¬ìš©
-- Breakpoints(ê¶Œì¥): narrow < 360, base 360â€“599, wide â‰¥ 600
-- ìœ„ì ¯: `LayoutBuilder`ë¡œ ë¶„ê¸°, ê¸¸ì–´ì§€ëŠ” ëª©ë¡ì€ Sliver ì‚¬ìš©
+- 8pt ê·¸ë¦¬ë“œ, ê¸°ë³¸ íŒ¨ë”© `context.spacing.x4` ì‚¬ìš©(í† í° ê²½ìœ )
+- Breakpoints(Material 3 ê¶Œì¥):
+  - compact < 600, medium 600â€“839, expanded â‰¥ 840
+  - ì°¸ê³ : ë‹¨ìˆœ 1ë‹¨/2ë‹¨/3ë‹¨ ë ˆì´ì•„ì›ƒ ë¶„ê¸°ì— í™œìš©
+- ìœ„ì ¯: `LayoutBuilder`/`MediaQuery.sizeOf(context)`ë¡œ ë¶„ê¸°, ê¸¸ì–´ì§€ëŠ” ëª©ë¡ì€ `ListView.builder` ë˜ëŠ” Sliver ì‚¬ìš©(ì¤‘ì²© ìŠ¤í¬ë¡¤ ì§€ì–‘)
 
 ## ì»´í¬ë„ŒíŠ¸ ê·œì•½(ìƒ˜í”Œ)
 - ë„¤ì´ë°: `XxxCard`, `XxxTile`, `XxxChip`, `XxxButton`
@@ -83,6 +85,9 @@ ThemeData buildAppTheme(Brightness brightness) {
 - ìƒíƒœ: `enabled/disabled`, `loading`, `error/unknown` ë“± enumìœ¼ë¡œ ë…¸ì¶œ
 - ì ‘ê·¼ì„±: `Semantics(label/hint)`, `ExcludeSemantics`ë¡œ ì¤‘ë³µ ì œê±°, í‚¤ë³´ë“œ í¬ì»¤ìŠ¤ ê³ ë ¤
 - í…ŒìŠ¤íŠ¸: `Key('ResultCard.TLDR')` ë“± TestKey í‘œì¤€í™”
+ - ë°©í–¥ì„±: ì—¬ë°±ì€ `EdgeInsetsDirectional` ìš°ì„  ì‚¬ìš©(RTL ëŒ€ë¹„)
+ - í„°ì¹˜ íƒ€ê²Ÿ: ëª¨ë“  ìƒí˜¸ì‘ìš© ìš”ì†Œ ìµœì†Œ 48Ã—48dp ë³´ì¥(Material ê°€ì´ë“œ)
+ - ì‰í¬ íš¨ê³¼: ë²„íŠ¼/íƒ­ ìš”ì†ŒëŠ” `InkWell`/`InkResponse` ë˜ëŠ” í‘œì¤€ ë²„íŠ¼ ìœ„ì ¯ ì‚¬ìš©(`GestureDetector` ë‹¨ë… ì§€ì–‘)
 
 ### IntakeQuestion ì‚¬ì–‘(ìš”ì•½)
 - props: `qid`, `label`, `options(List<Choice>)`, `onChanged`, `selected`, `showUnknown(bool)`
@@ -95,12 +100,14 @@ ThemeData buildAppTheme(Brightness brightness) {
 - A11y: ìƒ‰ìƒ ì™¸ êµ¬ë¶„(ì•„ì´ì½˜/í…ìŠ¤íŠ¸), ëŒ€ë¹„ ì¤€ìˆ˜
 
 ## ì ‘ê·¼ì„± ì²´í¬
-- ìµœì†Œ í„°ì¹˜ 44Ã—44, ë³¸ë¬¸ ëŒ€ë¹„ 4.5:1 ì´ìƒ
+- ìµœì†Œ í„°ì¹˜ 48Ã—48, ë³¸ë¬¸ ëŒ€ë¹„ 4.5:1 ì´ìƒ
 - Dynamic Type ëŒ€ì‘: `MediaQuery.textScaler` ë°˜ì˜, `FittedBox` ë‚¨ìš© ê¸ˆì§€
 - í¬ì»¤ìŠ¤ ìˆœì„œ: ë…¼ë¦¬ì  íƒ­ ìˆœì„œ ì„¤ì •(`FocusTraversalGroup`)
+ - ì„ íƒ ìƒíƒœ: Chip/í† ê¸€ ë“±ì€ `selected` ìƒíƒœê°€ ë³´ì´ìŠ¤ì˜¤ë²„ë¡œ ì½íˆë„ë¡ `Semantics(selected: ...)` ë˜ëŠ” ê¸°ë³¸ ìœ„ì ¯ ìƒíƒœ í™œìš©
 
 ## êµ­ì œí™”(i18n)
-- ìˆ«ì/ë‚ ì§œ/í†µí™” `intl` ì‚¬ìš©, í…ìŠ¤íŠ¸ ë¶„ë¦¬(l10n) â€” ë©”ì‹œì§€ í‚¤ëŠ” COPY_GUIDE ì°¸ì¡°
+- `flutter gen-l10n` ì‚¬ìš©(ì•± ì „ì—­ l10n), ë¬¸ìì—´ í•˜ë“œì½”ë”© ì§€ì–‘
+- ìˆ«ì/ë‚ ì§œ/í†µí™”ëŠ” `intl` ì‚¬ìš©, ë©”ì‹œì§€ í‚¤ëŠ” COPY_GUIDE ì°¸ì¡°
 
 ## ì„±ëŠ¥ ìˆ˜ì¹™
 - ê°€ëŠ¥í•œ `const` ì‚¬ìš©, `ListView.builder`/`SliverList` í™œìš©
diff --git a/docs/docs/SCREEN_SPECS.md b/docs/docs/SCREEN_SPECS.md
index 2a7ef07..aa56d81 100644
--- a/docs/docs/SCREEN_SPECS.md
+++ b/docs/docs/SCREEN_SPECS.md
@@ -63,10 +63,16 @@ Status: canonical (Screen Specs)
 - ê²°ê³¼ ì´í›„: `Composer.enabled=true`, ì¶”ì²œ ì§ˆë¬¸ ì¹© ë…¸ì¶œ
 - ë¡œë”©: `TypingIndicator`(bot), ê¸´ ë‹µë³€ `SummaryToggle`(TL;DR ë¨¼ì € ë³´ê¸°)
 - ì—ëŸ¬: `ErrorBubble`(bot) + `RetryButton`
+ - ì ‘ê·¼ì„±: ëª¨ë“  í„°ì¹˜ íƒ€ê²Ÿ 48Ã—48dp ì´ìƒ, ì¹©/ë²„íŠ¼ì€ ë¨¸í‹°ë¦¬ì–¼ í‘œì¤€ ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©(ì‰í¬ íš¨ê³¼ ë³´ì¡´)
 
 ### ì ‘ê·¼ì„±
 - Semantics: ChatBubble(role ë¼ë²¨), ChoiceChip ë¼ë²¨/í¬ì»¤ìŠ¤ ì´ë™, ë°°ì§€(ë§ˆì§€ë§‰ í™•ì¸ì¼) ì½ê¸°
 - í‚¤ë³´ë“œ í¬ì»¤ìŠ¤ ìˆœì„œ: ì§ˆë¬¸â†’ì˜µì…˜ ì¹©â†’ë‹¤ìŒ ìš”ì†Œ
+ - ë°©í–¥ì„±: ì—¬ë°±/ì •ë ¬ì€ EdgeInsetsDirectional/alignmentDirectional ì‚¬ìš©
+
+## ë¦¬ìŠ¤íŠ¸/ìŠ¤í¬ë¡¤ ê°€ì´ë“œ
+- ì¤‘ì²© ìŠ¤í¬ë¡¤ ì§€ì–‘. í•„ìš” ì‹œ `CustomScrollView` + Sliver ì¡°í•© ì‚¬ìš©
+- ê¸´ ë¦¬ìŠ¤íŠ¸ëŠ” `ListView.builder`/`SliverList` ì‚¬ìš©, `shrinkWrap` ê³¼ë„ ì‚¬ìš© ê¸ˆì§€
 
 ### ì´ë²¤íŠ¸ ë§¤í•‘
 - `intake_start`, `intake_answer{qid, is_unknown}`, `intake_complete{count, has_unknown, status}`
diff --git a/docs/docs/UI_UX_GUIDE.md b/docs/docs/UI_UX_GUIDE.md
index 105abc5..9e0a458 100644
--- a/docs/docs/UI_UX_GUIDE.md
+++ b/docs/docs/UI_UX_GUIDE.md
@@ -12,6 +12,7 @@ Status: canonical (UX Principles)
 - ì‹¤ìš© ìš”ì•½ í†¤: TL;DR â†’ ì´ìœ /ì˜ˆì™¸ â†’ ë‹¤ìŒ ë‹¨ê³„. ì™¸ë¶€ ë§í¬ ë¯¸ë…¸ì¶œ, ë§ˆì§€ë§‰ í™•ì¸ì¼ í‘œê¸°.
 - ì ‘ê·¼ì„±/A11y: ëŒ€ë¹„/í¬ê¸°, Semantics ë¼ë²¨, í„°ì¹˜ íƒ€ê²Ÿ â‰¥ 44dp.
 - ë””ìì¸ í† í° ì¤€ìˆ˜: ìƒ‰/ê°„ê²©/ë¼ìš´ë“œ/íƒ€ì´í¬ëŠ” í† í°ì—ì„œë§Œ ì‚¬ìš©.
+ - êµ­ì œí™”: `flutter gen-l10n` ê¸°ë°˜ ë¬¸ìì—´ ë¶„ë¦¬, í•˜ë“œì½”ë”© ì§€ì–‘
 
 ## IA/ë„¤ë¹„ê²Œì´ì…˜
 - ê¸°ë³¸ ì§„ì…: Conversation(ëŒ€í™”) í™”ë©´
@@ -30,6 +31,7 @@ Status: canonical (UX Principles)
 - ë¹ˆ ìƒíƒœ: ì²« ì§„ì… ì•ˆë‚´ ë²„ë¸” + â€œì‹œì‘í•˜ê¸°â€
 - ì—ëŸ¬: ë„¤íŠ¸ì›Œí¬/ì„œë²„ ì˜¤ë¥˜ëŠ” bot bubbleë¡œ ë…¸ì¶œ + ì¬ì‹œë„ ë²„íŠ¼
 - ê¸´ ë‹µë³€: â€œìš”ì•½ ë¨¼ì € ë³´ê¸°â€ í† ê¸€
+ - ìƒí˜¸ì‘ìš©: ë²„íŠ¼/ì¹©ì€ ìµœì†Œ 48Ã—48dp í„°ì¹˜ íƒ€ê²Ÿ í™•ë³´, ì‰í¬ íš¨ê³¼ ìœ ì§€(Material ë²„íŠ¼/Chip ê¶Œì¥)
 
 ## ì§„í–‰/ì™„ë£Œ íë¦„
 1) ë´‡ ì¸ì‚¬ â†’ A1..A7, P1..P7, S1 ìˆœì„œë¡œ ì§ˆë¬¸(ë¶„ê¸° í—ˆìš©)
@@ -46,6 +48,7 @@ Status: canonical (UX Principles)
 ## ë””ìì¸ í† í°
 - ìƒ‰/íƒ€ì´í¬/ê°„ê²©/ë¼ìš´ë“œ: DESIGN_TOKENS.yaml ì°¸ì¡°
 - í™”ë©´ ë°°ì¹˜/ì»´í¬ë„ŒíŠ¸ ë°°ì¹˜ëŠ” UI_BLUEPRINT.yaml ì°¸ì¡°
+ - ë°©í–¥ì„±: ì—¬ë°±ì€ EdgeInsetsDirectional ìš°ì„ (RTL ëŒ€ë¹„)
 
 ## ì¹´í”¼/í†¤
 - COPY_GUIDE.md, RESULT_CARD_COPY.mdë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¬¸êµ¬ ì„ íƒ
-- 
2.39.5 (Apple Git-154)


From ca4cd548662f21a814185c28d5e7f3789678ef6a Mon Sep 17 00:00:00 2001
From: codex <codex@example.com>
Date: Wed, 3 Sep 2025 15:09:36 +0900
Subject: [PATCH 07/13] feat(conversation): add ChatRepository (API + mock) and
 wire ConversationPage to call backend for bot replies; add http dep

---
 .../conversation/data/chat_models.dart        | 36 +++++++++
 .../conversation/data/chat_repository.dart    | 73 +++++++++++++++++++
 .../conversation/ui/conversation_page.dart    | 49 +++++++++++--
 pubspec.yaml                                  |  3 +
 4 files changed, 155 insertions(+), 6 deletions(-)
 create mode 100644 lib/features/conversation/data/chat_models.dart
 create mode 100644 lib/features/conversation/data/chat_repository.dart

diff --git a/lib/features/conversation/data/chat_models.dart b/lib/features/conversation/data/chat_models.dart
new file mode 100644
index 0000000..a08e2de
--- /dev/null
+++ b/lib/features/conversation/data/chat_models.dart
@@ -0,0 +1,36 @@
+import 'package:flutter/material.dart';
+
+@immutable
+class ChatCitation {
+  final String docId;
+  final String sectionKey;
+  const ChatCitation({required this.docId, required this.sectionKey});
+}
+
+@immutable
+class BotReply {
+  final String content;
+  final List<ChatCitation> citations;
+  final String lastVerified; // YYYY-MM-DD
+  const BotReply({required this.content, required this.citations, required this.lastVerified});
+
+  factory BotReply.fromJson(Map<String, dynamic> json) {
+    final cites = (json['citations'] as List<dynamic>? ?? const [])
+        .whereType<Map<String, dynamic>>()
+        .map((e) => ChatCitation(docId: e['docId'] ?? '', sectionKey: e['section'] ?? e['sectionKey'] ?? ''))
+        .toList();
+    return BotReply(
+      content: json['content'] ?? '',
+      citations: cites,
+      lastVerified: json['lastVerified'] ?? '',
+    );
+  }
+}
+
+class ChatError implements Exception {
+  final String message;
+  ChatError(this.message);
+  @override
+  String toString() => 'ChatError: $message';
+}
+
diff --git a/lib/features/conversation/data/chat_repository.dart b/lib/features/conversation/data/chat_repository.dart
new file mode 100644
index 0000000..a8704bc
--- /dev/null
+++ b/lib/features/conversation/data/chat_repository.dart
@@ -0,0 +1,73 @@
+import 'dart:convert';
+import 'package:http/http.dart' as http;
+import 'chat_models.dart';
+
+abstract class ChatRepository {
+  Future<void> ensureSession();
+  Future<BotReply> complete(String userText);
+}
+
+class ApiChatRepository implements ChatRepository {
+  final String baseUrl; // e.g., http://localhost:8080/api
+  final http.Client _client;
+  String? _sessionId;
+
+  ApiChatRepository({String? baseUrl, http.Client? client})
+      : baseUrl = baseUrl ?? const String.fromEnvironment('CHAT_API_BASE', defaultValue: 'http://localhost:8080/api'),
+        _client = client ?? http.Client();
+
+  @override
+  Future<void> ensureSession() async {
+    if (_sessionId != null) return;
+    final r = await _client.post(Uri.parse('$baseUrl/chat/session'));
+    if (r.statusCode ~/ 100 != 2) {
+      throw ChatError('session create failed (${r.statusCode})');
+    }
+    final body = jsonDecode(r.body) as Map<String, dynamic>;
+    _sessionId = body['sessionId']?.toString();
+    if (_sessionId == null || _sessionId!.isEmpty) {
+      throw ChatError('invalid session id');
+    }
+  }
+
+  @override
+  Future<BotReply> complete(String userText) async {
+    await ensureSession();
+    // Optional: send message to history endpoint (if server expects)
+    await _client.post(
+      Uri.parse('$baseUrl/chat/messages'),
+      headers: {'Content-Type': 'application/json'},
+      body: jsonEncode({'sessionId': _sessionId, 'role': 'user', 'content': userText}),
+    );
+
+    final r = await _client.post(
+      Uri.parse('$baseUrl/chat/complete'),
+      headers: {'Content-Type': 'application/json'},
+      body: jsonEncode({'sessionId': _sessionId, 'prompt': userText}),
+    );
+    if (r.statusCode ~/ 100 != 2) {
+      throw ChatError('complete failed (${r.statusCode})');
+    }
+    final body = jsonDecode(r.body) as Map<String, dynamic>;
+    return BotReply.fromJson(body);
+  }
+}
+
+/// Mock fallback for local/dev when API server is not available.
+class MockChatRepository implements ChatRepository {
+  final String lastVerified;
+  MockChatRepository({this.lastVerified = '2025-09-02'});
+  @override
+  Future<void> ensureSession() async {}
+
+  @override
+  Future<BotReply> complete(String userText) async {
+    await Future.delayed(const Duration(milliseconds: 400));
+    return BotReply(
+      content: 'TL;DR: ì„œë¥˜ëŠ” ì‹ ë¶„ì¦, ê°€ì¡±Â·í˜¼ì¸ê´€ê³„, ì†Œë“ ì¦ë¹™ì´ ê¸°ë³¸ì…ë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ë°œê¸‰ì²˜/ìˆœì„œë¥¼ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.',
+      citations: const [ChatCitation(docId: 'HUG_internal_policy.md', sectionKey: 'A.1')],
+      lastVerified: lastVerified,
+    );
+  }
+}
+
diff --git a/lib/features/conversation/ui/conversation_page.dart b/lib/features/conversation/ui/conversation_page.dart
index 6b2f74f..b3a0afd 100644
--- a/lib/features/conversation/ui/conversation_page.dart
+++ b/lib/features/conversation/ui/conversation_page.dart
@@ -8,6 +8,8 @@ import '../../../ui/components/typing_indicator.dart';
 import '../../../ui/components/ad_slot.dart';
 import '../../../common/analytics/analytics.dart';
 import '../../../ui/components/appear.dart';
+import '../../conversation/data/chat_repository.dart';
+import '../../conversation/data/chat_models.dart' as model;
 
 class ConversationPage extends StatefulWidget {
   const ConversationPage({super.key});
@@ -28,6 +30,10 @@ class _ConversationPageState extends State<ConversationPage> {
 
   static const _unknown = '__unknown__';
 
+  // Chat repository (API-backed; falls back to mock if needed)
+  late final ChatRepository _chatRepo;
+  int? _typingRowIndex;
+
   @override
   void initState() {
     super.initState();
@@ -36,6 +42,8 @@ class _ConversationPageState extends State<ConversationPage> {
       _appendBotText('ê°„ë‹¨ ì¡°ì‚¬ë¥¼ í†µí•´ ë§ì¶¤ ì•ˆë‚´ë¥¼ ì¤€ë¹„í• ê²Œìš”. ì´í›„ ì˜ˆë¹„íŒì •ì„ ì§„í–‰í•©ë‹ˆë‹¤.');
       _askCurrent();
     });
+    // Initialize chat repository (swap to ApiChatRepository when backend is ready)
+    _chatRepo = ApiChatRepository();
   }
 
   @override
@@ -270,13 +278,42 @@ class _ConversationPageState extends State<ConversationPage> {
     _composer.clear();
     _appendUserText(text);
     Analytics.instance.qnaAsk('free', text.length);
-    // Stubbed bot answer following RAG policy tone
-    _rows.add(_Row.botRich(const ChatBubble(
+    // Show typing indicator and request completion from repository
+    final typingIndex = _showTyping();
+    _chatRepo.complete(text).then((reply) {
+      _replaceTypingWithReply(typingIndex, reply);
+      Analytics.instance.qnaAnswer(true, reply.lastVerified.isEmpty ? '2025-09-02' : reply.lastVerified);
+    }).catchError((e) {
+      // Fallback simple error message in bot bubble
+      _replaceTypingWithError(typingIndex, 'ì§€ê¸ˆì€ ë‹µë³€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
+    });
+  }
+
+  int _showTyping() {
+    _rows.add(_Row.botRich(const TypingIndicator()));
+    _typingRowIndex = _rows.length - 1;
+    setState(() {});
+    return _typingRowIndex!;
+  }
+
+  void _replaceTypingWithReply(int typingIndex, model.BotReply reply) {
+    // Convert model citations to UI component citations
+    final cites = reply.citations
+        .map((c) => Citation(c.docId, c.sectionKey))
+        .toList();
+    _rows[typingIndex] = _Row.botRich(ChatBubble(
       role: ChatRole.bot,
-      content: 'TL;DR: ì„œë¥˜ëŠ” ì‹ ë¶„ì¦, ê°€ì¡±Â·í˜¼ì¸ê´€ê³„, ì†Œë“ ì¦ë¹™ì´ ê¸°ë³¸ì…ë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ë°œê¸‰ì²˜/ìˆœì„œë¥¼ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.',
-      citations: [Citation('HUG_internal_policy.md', 'A.1')],
-    )));
-    Analytics.instance.qnaAnswer(true, '2025-09-02');
+      content: reply.content,
+      citations: cites,
+    ));
+    setState(() {});
+  }
+
+  void _replaceTypingWithError(int typingIndex, String message) {
+    _rows[typingIndex] = _Row.botRich(ChatBubble(
+      role: ChatRole.bot,
+      content: message,
+    ));
     setState(() {});
   }
 
diff --git a/pubspec.yaml b/pubspec.yaml
index 2448ed6..41697e8 100644
--- a/pubspec.yaml
+++ b/pubspec.yaml
@@ -47,6 +47,9 @@ dependencies:
   
   # Local storage
   shared_preferences: ^2.3.2
+  
+  # HTTP client (API)
+  http: ^1.2.2
 
 dev_dependencies:
   flutter_test:
-- 
2.39.5 (Apple Git-154)


From ac0d25c6f0a2a393249e9b7b9d3e6b0e6442213f Mon Sep 17 00:00:00 2001
From: codex <codex@example.com>
Date: Wed, 3 Sep 2025 15:21:09 +0900
Subject: [PATCH 08/13] feat(conversation): introduce ChatCubit and DI via
 RepositoryProvider; wire ConversationPage to Bloc (typing->reply/error)

---
 .../conversation/bloc/chat_cubit.dart         | 32 +++++++++++++
 .../conversation/ui/conversation_page.dart    | 47 +++++++++++--------
 lib/main.dart                                 | 17 ++++---
 3 files changed, 71 insertions(+), 25 deletions(-)
 create mode 100644 lib/features/conversation/bloc/chat_cubit.dart

diff --git a/lib/features/conversation/bloc/chat_cubit.dart b/lib/features/conversation/bloc/chat_cubit.dart
new file mode 100644
index 0000000..c00f390
--- /dev/null
+++ b/lib/features/conversation/bloc/chat_cubit.dart
@@ -0,0 +1,32 @@
+import 'package:flutter/foundation.dart';
+import 'package:flutter_bloc/flutter_bloc.dart';
+import '../../conversation/data/chat_repository.dart';
+import '../../conversation/data/chat_models.dart' as model;
+
+@immutable
+class ChatState {
+  final bool loading;
+  final model.BotReply? reply;
+  final String? error;
+  const ChatState({this.loading = false, this.reply, this.error});
+
+  ChatState copyWith({bool? loading, model.BotReply? reply, String? error}) =>
+      ChatState(loading: loading ?? this.loading, reply: reply, error: error);
+}
+
+class ChatCubit extends Cubit<ChatState> {
+  final ChatRepository repo;
+  ChatCubit(this.repo) : super(const ChatState());
+
+  Future<void> send(String text) async {
+    emit(state.copyWith(loading: true, reply: null, error: null));
+    try {
+      await repo.ensureSession();
+      final r = await repo.complete(text);
+      emit(ChatState(loading: false, reply: r));
+    } catch (e) {
+      emit(ChatState(loading: false, error: 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.'));
+    }
+  }
+}
+
diff --git a/lib/features/conversation/ui/conversation_page.dart b/lib/features/conversation/ui/conversation_page.dart
index b3a0afd..5b24243 100644
--- a/lib/features/conversation/ui/conversation_page.dart
+++ b/lib/features/conversation/ui/conversation_page.dart
@@ -8,6 +8,8 @@ import '../../../ui/components/typing_indicator.dart';
 import '../../../ui/components/ad_slot.dart';
 import '../../../common/analytics/analytics.dart';
 import '../../../ui/components/appear.dart';
+import 'package:flutter_bloc/flutter_bloc.dart';
+import '../../conversation/bloc/chat_cubit.dart';
 import '../../conversation/data/chat_repository.dart';
 import '../../conversation/data/chat_models.dart' as model;
 
@@ -30,8 +32,6 @@ class _ConversationPageState extends State<ConversationPage> {
 
   static const _unknown = '__unknown__';
 
-  // Chat repository (API-backed; falls back to mock if needed)
-  late final ChatRepository _chatRepo;
   int? _typingRowIndex;
 
   @override
@@ -42,8 +42,6 @@ class _ConversationPageState extends State<ConversationPage> {
       _appendBotText('ê°„ë‹¨ ì¡°ì‚¬ë¥¼ í†µí•´ ë§ì¶¤ ì•ˆë‚´ë¥¼ ì¤€ë¹„í• ê²Œìš”. ì´í›„ ì˜ˆë¹„íŒì •ì„ ì§„í–‰í•©ë‹ˆë‹¤.');
       _askCurrent();
     });
-    // Initialize chat repository (swap to ApiChatRepository when backend is ready)
-    _chatRepo = ApiChatRepository();
   }
 
   @override
@@ -278,15 +276,9 @@ class _ConversationPageState extends State<ConversationPage> {
     _composer.clear();
     _appendUserText(text);
     Analytics.instance.qnaAsk('free', text.length);
-    // Show typing indicator and request completion from repository
-    final typingIndex = _showTyping();
-    _chatRepo.complete(text).then((reply) {
-      _replaceTypingWithReply(typingIndex, reply);
-      Analytics.instance.qnaAnswer(true, reply.lastVerified.isEmpty ? '2025-09-02' : reply.lastVerified);
-    }).catchError((e) {
-      // Fallback simple error message in bot bubble
-      _replaceTypingWithError(typingIndex, 'ì§€ê¸ˆì€ ë‹µë³€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
-    });
+    // Show typing indicator and request completion via Cubit
+    _typingRowIndex = _showTyping();
+    context.read<ChatCubit>().send(text);
   }
 
   int _showTyping() {
@@ -320,11 +312,27 @@ class _ConversationPageState extends State<ConversationPage> {
   @override
   Widget build(BuildContext context) {
     final spacing = context.spacing;
-    return Scaffold(
-      appBar: AppBar(title: const Text('ëŒ€í™”í˜• ì˜ˆë¹„íŒì •')),
-      body: SafeArea(
-        child: Column(
-          children: [
+    return BlocProvider<ChatCubit>(
+      create: (ctx) => ChatCubit(RepositoryProvider.of(ctx)),
+      child: BlocListener<ChatCubit, ChatState>(
+        listener: (context, state) {
+          if (_typingRowIndex != null) {
+            if (state.reply != null) {
+              _replaceTypingWithReply(_typingRowIndex!, state.reply!);
+              Analytics.instance.qnaAnswer(true,
+                  state.reply!.lastVerified.isEmpty ? '2025-09-02' : state.reply!.lastVerified);
+              _typingRowIndex = null;
+            } else if (state.error != null) {
+              _replaceTypingWithError(_typingRowIndex!, state.error!);
+              _typingRowIndex = null;
+            }
+          }
+        },
+        child: Scaffold(
+          appBar: AppBar(title: const Text('ëŒ€í™”í˜• ì˜ˆë¹„íŒì •')),
+          body: SafeArea(
+            child: Column(
+              children: [
             Expanded(
               child: ListView.builder(
                 padding: EdgeInsets.all(spacing.x4),
@@ -431,7 +439,8 @@ class _ConversationPageState extends State<ConversationPage> {
           ],
         ),
       ),
-    );
+    ),
+  );
   }
 
   // Question flow (full v1 per INTAKE_FLOW.md)
diff --git a/lib/main.dart b/lib/main.dart
index 897b6d7..fe4a04e 100644
--- a/lib/main.dart
+++ b/lib/main.dart
@@ -1,6 +1,8 @@
 import 'package:flutter/material.dart';
 import 'ui/theme/app_theme.dart';
 import 'features/shell/ui/app_shell.dart';
+import 'features/conversation/data/chat_repository.dart';
+import 'package:flutter_bloc/flutter_bloc.dart';
 
 void main() {
   runApp(const MyApp());
@@ -11,12 +13,15 @@ class MyApp extends StatelessWidget {
 
   @override
   Widget build(BuildContext context) {
-    return MaterialApp(
-      title: 'ì „ì„¸ìê¸ˆëŒ€ì¶œ ë„ìš°ë¯¸',
-      theme: buildAppTheme(Brightness.light),
-      darkTheme: buildAppTheme(Brightness.dark),
-      themeMode: ThemeMode.system,
-      home: const AppShell(),
+    return RepositoryProvider<ChatRepository>(
+      create: (_) => ApiChatRepository(),
+      child: MaterialApp(
+        title: 'ì „ì„¸ìê¸ˆëŒ€ì¶œ ë„ìš°ë¯¸',
+        theme: buildAppTheme(Brightness.light),
+        darkTheme: buildAppTheme(Brightness.dark),
+        themeMode: ThemeMode.system,
+        home: const AppShell(),
+      ),
     );
   }
 }
-- 
2.39.5 (Apple Git-154)


From 46827cfd8bc2b1ee12a6f3aae18426897cb15504 Mon Sep 17 00:00:00 2001
From: codex <codex@example.com>
Date: Wed, 3 Sep 2025 15:28:43 +0900
Subject: [PATCH 09/13] refactor(conversation): apply Freezed to chat models
 and ChatState; add json_serializable and generation hooks (run build_runner)

---
 .../conversation/bloc/chat_cubit.dart         | 26 ++++++------
 .../conversation/data/chat_models.dart        | 40 ++++++++-----------
 .../conversation/data/chat_repository.dart    | 23 +++++++++--
 .../conversation/ui/conversation_page.dart    | 28 ++++++++-----
 4 files changed, 65 insertions(+), 52 deletions(-)

diff --git a/lib/features/conversation/bloc/chat_cubit.dart b/lib/features/conversation/bloc/chat_cubit.dart
index c00f390..1171c3e 100644
--- a/lib/features/conversation/bloc/chat_cubit.dart
+++ b/lib/features/conversation/bloc/chat_cubit.dart
@@ -1,32 +1,30 @@
-import 'package:flutter/foundation.dart';
 import 'package:flutter_bloc/flutter_bloc.dart';
+import 'package:freezed_annotation/freezed_annotation.dart';
 import '../../conversation/data/chat_repository.dart';
 import '../../conversation/data/chat_models.dart' as model;
 
-@immutable
-class ChatState {
-  final bool loading;
-  final model.BotReply? reply;
-  final String? error;
-  const ChatState({this.loading = false, this.reply, this.error});
+part 'chat_cubit.freezed.dart';
 
-  ChatState copyWith({bool? loading, model.BotReply? reply, String? error}) =>
-      ChatState(loading: loading ?? this.loading, reply: reply, error: error);
+@freezed
+class ChatState with _$ChatState {
+  const factory ChatState.idle() = _Idle;
+  const factory ChatState.loading() = _Loading;
+  const factory ChatState.success(model.BotReply reply) = _Success;
+  const factory ChatState.error(String message) = _Error;
 }
 
 class ChatCubit extends Cubit<ChatState> {
   final ChatRepository repo;
-  ChatCubit(this.repo) : super(const ChatState());
+  ChatCubit(this.repo) : super(const ChatState.idle());
 
   Future<void> send(String text) async {
-    emit(state.copyWith(loading: true, reply: null, error: null));
+    emit(const ChatState.loading());
     try {
       await repo.ensureSession();
       final r = await repo.complete(text);
-      emit(ChatState(loading: false, reply: r));
+      emit(ChatState.success(r));
     } catch (e) {
-      emit(ChatState(loading: false, error: 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.'));
+      emit(const ChatState.error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.'));
     }
   }
 }
-
diff --git a/lib/features/conversation/data/chat_models.dart b/lib/features/conversation/data/chat_models.dart
index a08e2de..9d0cd82 100644
--- a/lib/features/conversation/data/chat_models.dart
+++ b/lib/features/conversation/data/chat_models.dart
@@ -1,30 +1,23 @@
-import 'package:flutter/material.dart';
+import 'package:freezed_annotation/freezed_annotation.dart';
 
-@immutable
-class ChatCitation {
-  final String docId;
-  final String sectionKey;
-  const ChatCitation({required this.docId, required this.sectionKey});
+part 'chat_models.freezed.dart';
+part 'chat_models.g.dart';
+
+@freezed
+class ChatCitation with _$ChatCitation {
+  const factory ChatCitation({required String docId, required String sectionKey}) = _ChatCitation;
+  factory ChatCitation.fromJson(Map<String, dynamic> json) => _$ChatCitationFromJson(json);
 }
 
-@immutable
-class BotReply {
-  final String content;
-  final List<ChatCitation> citations;
-  final String lastVerified; // YYYY-MM-DD
-  const BotReply({required this.content, required this.citations, required this.lastVerified});
+@freezed
+class BotReply with _$BotReply {
+  const factory BotReply({
+    required String content,
+    @Default(<ChatCitation>[]) List<ChatCitation> citations,
+    required String lastVerified, // YYYY-MM-DD
+  }) = _BotReply;
 
-  factory BotReply.fromJson(Map<String, dynamic> json) {
-    final cites = (json['citations'] as List<dynamic>? ?? const [])
-        .whereType<Map<String, dynamic>>()
-        .map((e) => ChatCitation(docId: e['docId'] ?? '', sectionKey: e['section'] ?? e['sectionKey'] ?? ''))
-        .toList();
-    return BotReply(
-      content: json['content'] ?? '',
-      citations: cites,
-      lastVerified: json['lastVerified'] ?? '',
-    );
-  }
+  factory BotReply.fromJson(Map<String, dynamic> json) => _$BotReplyFromJson(json);
 }
 
 class ChatError implements Exception {
@@ -33,4 +26,3 @@ class ChatError implements Exception {
   @override
   String toString() => 'ChatError: $message';
 }
-
diff --git a/lib/features/conversation/data/chat_repository.dart b/lib/features/conversation/data/chat_repository.dart
index a8704bc..4135c55 100644
--- a/lib/features/conversation/data/chat_repository.dart
+++ b/lib/features/conversation/data/chat_repository.dart
@@ -48,8 +48,9 @@ class ApiChatRepository implements ChatRepository {
     if (r.statusCode ~/ 100 != 2) {
       throw ChatError('complete failed (${r.statusCode})');
     }
-    final body = jsonDecode(r.body) as Map<String, dynamic>;
-    return BotReply.fromJson(body);
+    final raw = jsonDecode(r.body) as Map<String, dynamic>;
+    final norm = _normalizeReplyJson(raw);
+    return BotReply.fromJson(norm);
   }
 }
 
@@ -64,10 +65,26 @@ class MockChatRepository implements ChatRepository {
   Future<BotReply> complete(String userText) async {
     await Future.delayed(const Duration(milliseconds: 400));
     return BotReply(
-      content: 'TL;DR: ì„œë¥˜ëŠ” ì‹ ë¶„ì¦, ê°€ì¡±Â·í˜¼ì¸ê´€ê³„, ì†Œë“ ì¦ë¹™ì´ ê¸°ë³¸ì…ë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ë°œê¸‰ì²˜/ìˆœì„œë¥¼ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.',
+      content:
+          'TL;DR: ì„œë¥˜ëŠ” ì‹ ë¶„ì¦, ê°€ì¡±Â·í˜¼ì¸ê´€ê³„, ì†Œë“ ì¦ë¹™ì´ ê¸°ë³¸ì…ë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ë°œê¸‰ì²˜/ìˆœì„œë¥¼ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.',
       citations: const [ChatCitation(docId: 'HUG_internal_policy.md', sectionKey: 'A.1')],
       lastVerified: lastVerified,
     );
   }
 }
 
+Map<String, dynamic> _normalizeReplyJson(Map<String, dynamic> json) {
+  final out = Map<String, dynamic>.from(json);
+  final citations = (out['citations'] as List<dynamic>? ?? const [])
+      .whereType<Map<String, dynamic>>()
+      .map((e) {
+    final m = Map<String, dynamic>.from(e);
+    // Accept either 'section' or 'sectionKey'
+    if (!m.containsKey('sectionKey') && m.containsKey('section')) {
+      m['sectionKey'] = m['section'];
+    }
+    return m;
+  }).toList();
+  out['citations'] = citations;
+  return out;
+}
diff --git a/lib/features/conversation/ui/conversation_page.dart b/lib/features/conversation/ui/conversation_page.dart
index 5b24243..46c27f1 100644
--- a/lib/features/conversation/ui/conversation_page.dart
+++ b/lib/features/conversation/ui/conversation_page.dart
@@ -316,17 +316,23 @@ class _ConversationPageState extends State<ConversationPage> {
       create: (ctx) => ChatCubit(RepositoryProvider.of(ctx)),
       child: BlocListener<ChatCubit, ChatState>(
         listener: (context, state) {
-          if (_typingRowIndex != null) {
-            if (state.reply != null) {
-              _replaceTypingWithReply(_typingRowIndex!, state.reply!);
-              Analytics.instance.qnaAnswer(true,
-                  state.reply!.lastVerified.isEmpty ? '2025-09-02' : state.reply!.lastVerified);
-              _typingRowIndex = null;
-            } else if (state.error != null) {
-              _replaceTypingWithError(_typingRowIndex!, state.error!);
-              _typingRowIndex = null;
-            }
-          }
+          state.maybeWhen(
+            success: (reply) {
+              if (_typingRowIndex != null) {
+                _replaceTypingWithReply(_typingRowIndex!, reply);
+                Analytics.instance
+                    .qnaAnswer(true, reply.lastVerified.isEmpty ? '2025-09-02' : reply.lastVerified);
+                _typingRowIndex = null;
+              }
+            },
+            error: (msg) {
+              if (_typingRowIndex != null) {
+                _replaceTypingWithError(_typingRowIndex!, msg);
+                _typingRowIndex = null;
+              }
+            },
+            orElse: () {},
+          );
         },
         child: Scaffold(
           appBar: AppBar(title: const Text('ëŒ€í™”í˜• ì˜ˆë¹„íŒì •')),
-- 
2.39.5 (Apple Git-154)


From 21258d524bcd2d94d85132d12cb0d5a65d191247 Mon Sep 17 00:00:00 2001
From: codex <codex@example.com>
Date: Wed, 3 Sep 2025 16:07:42 +0900
Subject: [PATCH 10/13] fix(build): import Freezed models without prefix to
 expose  to ChatState generator; adjust UI imports accordingly

---
 .../conversation/bloc/chat_cubit.dart         |   4 +-
 .../conversation/bloc/chat_cubit.freezed.dart | 640 ++++++++++++++++++
 .../data/chat_models.freezed.dart             | 412 +++++++++++
 .../conversation/data/chat_models.g.dart      |  37 +
 .../conversation/ui/conversation_page.dart    |   7 +-
 pubspec.lock                                  |   2 +-
 6 files changed, 1096 insertions(+), 6 deletions(-)
 create mode 100644 lib/features/conversation/bloc/chat_cubit.freezed.dart
 create mode 100644 lib/features/conversation/data/chat_models.freezed.dart
 create mode 100644 lib/features/conversation/data/chat_models.g.dart

diff --git a/lib/features/conversation/bloc/chat_cubit.dart b/lib/features/conversation/bloc/chat_cubit.dart
index 1171c3e..f6de4a8 100644
--- a/lib/features/conversation/bloc/chat_cubit.dart
+++ b/lib/features/conversation/bloc/chat_cubit.dart
@@ -1,7 +1,7 @@
 import 'package:flutter_bloc/flutter_bloc.dart';
 import 'package:freezed_annotation/freezed_annotation.dart';
 import '../../conversation/data/chat_repository.dart';
-import '../../conversation/data/chat_models.dart' as model;
+import '../../conversation/data/chat_models.dart';
 
 part 'chat_cubit.freezed.dart';
 
@@ -9,7 +9,7 @@ part 'chat_cubit.freezed.dart';
 class ChatState with _$ChatState {
   const factory ChatState.idle() = _Idle;
   const factory ChatState.loading() = _Loading;
-  const factory ChatState.success(model.BotReply reply) = _Success;
+  const factory ChatState.success(BotReply reply) = _Success;
   const factory ChatState.error(String message) = _Error;
 }
 
diff --git a/lib/features/conversation/bloc/chat_cubit.freezed.dart b/lib/features/conversation/bloc/chat_cubit.freezed.dart
new file mode 100644
index 0000000..8d3dd0a
--- /dev/null
+++ b/lib/features/conversation/bloc/chat_cubit.freezed.dart
@@ -0,0 +1,640 @@
+// coverage:ignore-file
+// GENERATED CODE - DO NOT MODIFY BY HAND
+// ignore_for_file: type=lint
+// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark
+
+part of 'chat_cubit.dart';
+
+// **************************************************************************
+// FreezedGenerator
+// **************************************************************************
+
+T _$identity<T>(T value) => value;
+
+final _privateConstructorUsedError = UnsupportedError(
+  'It seems like you constructed your class using `MyClass._()`. This constructor is only meant to be used by freezed and you are not supposed to need it nor use it.\nPlease check the documentation here for more information: https://github.com/rrousselGit/freezed#adding-getters-and-methods-to-our-models',
+);
+
+/// @nodoc
+mixin _$ChatState {
+  @optionalTypeArgs
+  TResult when<TResult extends Object?>({
+    required TResult Function() idle,
+    required TResult Function() loading,
+    required TResult Function(BotReply reply) success,
+    required TResult Function(String message) error,
+  }) => throw _privateConstructorUsedError;
+  @optionalTypeArgs
+  TResult? whenOrNull<TResult extends Object?>({
+    TResult? Function()? idle,
+    TResult? Function()? loading,
+    TResult? Function(BotReply reply)? success,
+    TResult? Function(String message)? error,
+  }) => throw _privateConstructorUsedError;
+  @optionalTypeArgs
+  TResult maybeWhen<TResult extends Object?>({
+    TResult Function()? idle,
+    TResult Function()? loading,
+    TResult Function(BotReply reply)? success,
+    TResult Function(String message)? error,
+    required TResult orElse(),
+  }) => throw _privateConstructorUsedError;
+  @optionalTypeArgs
+  TResult map<TResult extends Object?>({
+    required TResult Function(_Idle value) idle,
+    required TResult Function(_Loading value) loading,
+    required TResult Function(_Success value) success,
+    required TResult Function(_Error value) error,
+  }) => throw _privateConstructorUsedError;
+  @optionalTypeArgs
+  TResult? mapOrNull<TResult extends Object?>({
+    TResult? Function(_Idle value)? idle,
+    TResult? Function(_Loading value)? loading,
+    TResult? Function(_Success value)? success,
+    TResult? Function(_Error value)? error,
+  }) => throw _privateConstructorUsedError;
+  @optionalTypeArgs
+  TResult maybeMap<TResult extends Object?>({
+    TResult Function(_Idle value)? idle,
+    TResult Function(_Loading value)? loading,
+    TResult Function(_Success value)? success,
+    TResult Function(_Error value)? error,
+    required TResult orElse(),
+  }) => throw _privateConstructorUsedError;
+}
+
+/// @nodoc
+abstract class $ChatStateCopyWith<$Res> {
+  factory $ChatStateCopyWith(ChatState value, $Res Function(ChatState) then) =
+      _$ChatStateCopyWithImpl<$Res, ChatState>;
+}
+
+/// @nodoc
+class _$ChatStateCopyWithImpl<$Res, $Val extends ChatState>
+    implements $ChatStateCopyWith<$Res> {
+  _$ChatStateCopyWithImpl(this._value, this._then);
+
+  // ignore: unused_field
+  final $Val _value;
+  // ignore: unused_field
+  final $Res Function($Val) _then;
+
+  /// Create a copy of ChatState
+  /// with the given fields replaced by the non-null parameter values.
+}
+
+/// @nodoc
+abstract class _$$IdleImplCopyWith<$Res> {
+  factory _$$IdleImplCopyWith(
+    _$IdleImpl value,
+    $Res Function(_$IdleImpl) then,
+  ) = __$$IdleImplCopyWithImpl<$Res>;
+}
+
+/// @nodoc
+class __$$IdleImplCopyWithImpl<$Res>
+    extends _$ChatStateCopyWithImpl<$Res, _$IdleImpl>
+    implements _$$IdleImplCopyWith<$Res> {
+  __$$IdleImplCopyWithImpl(_$IdleImpl _value, $Res Function(_$IdleImpl) _then)
+    : super(_value, _then);
+
+  /// Create a copy of ChatState
+  /// with the given fields replaced by the non-null parameter values.
+}
+
+/// @nodoc
+
+class _$IdleImpl implements _Idle {
+  const _$IdleImpl();
+
+  @override
+  String toString() {
+    return 'ChatState.idle()';
+  }
+
+  @override
+  bool operator ==(Object other) {
+    return identical(this, other) ||
+        (other.runtimeType == runtimeType && other is _$IdleImpl);
+  }
+
+  @override
+  int get hashCode => runtimeType.hashCode;
+
+  @override
+  @optionalTypeArgs
+  TResult when<TResult extends Object?>({
+    required TResult Function() idle,
+    required TResult Function() loading,
+    required TResult Function(BotReply reply) success,
+    required TResult Function(String message) error,
+  }) {
+    return idle();
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult? whenOrNull<TResult extends Object?>({
+    TResult? Function()? idle,
+    TResult? Function()? loading,
+    TResult? Function(BotReply reply)? success,
+    TResult? Function(String message)? error,
+  }) {
+    return idle?.call();
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult maybeWhen<TResult extends Object?>({
+    TResult Function()? idle,
+    TResult Function()? loading,
+    TResult Function(BotReply reply)? success,
+    TResult Function(String message)? error,
+    required TResult orElse(),
+  }) {
+    if (idle != null) {
+      return idle();
+    }
+    return orElse();
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult map<TResult extends Object?>({
+    required TResult Function(_Idle value) idle,
+    required TResult Function(_Loading value) loading,
+    required TResult Function(_Success value) success,
+    required TResult Function(_Error value) error,
+  }) {
+    return idle(this);
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult? mapOrNull<TResult extends Object?>({
+    TResult? Function(_Idle value)? idle,
+    TResult? Function(_Loading value)? loading,
+    TResult? Function(_Success value)? success,
+    TResult? Function(_Error value)? error,
+  }) {
+    return idle?.call(this);
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult maybeMap<TResult extends Object?>({
+    TResult Function(_Idle value)? idle,
+    TResult Function(_Loading value)? loading,
+    TResult Function(_Success value)? success,
+    TResult Function(_Error value)? error,
+    required TResult orElse(),
+  }) {
+    if (idle != null) {
+      return idle(this);
+    }
+    return orElse();
+  }
+}
+
+abstract class _Idle implements ChatState {
+  const factory _Idle() = _$IdleImpl;
+}
+
+/// @nodoc
+abstract class _$$LoadingImplCopyWith<$Res> {
+  factory _$$LoadingImplCopyWith(
+    _$LoadingImpl value,
+    $Res Function(_$LoadingImpl) then,
+  ) = __$$LoadingImplCopyWithImpl<$Res>;
+}
+
+/// @nodoc
+class __$$LoadingImplCopyWithImpl<$Res>
+    extends _$ChatStateCopyWithImpl<$Res, _$LoadingImpl>
+    implements _$$LoadingImplCopyWith<$Res> {
+  __$$LoadingImplCopyWithImpl(
+    _$LoadingImpl _value,
+    $Res Function(_$LoadingImpl) _then,
+  ) : super(_value, _then);
+
+  /// Create a copy of ChatState
+  /// with the given fields replaced by the non-null parameter values.
+}
+
+/// @nodoc
+
+class _$LoadingImpl implements _Loading {
+  const _$LoadingImpl();
+
+  @override
+  String toString() {
+    return 'ChatState.loading()';
+  }
+
+  @override
+  bool operator ==(Object other) {
+    return identical(this, other) ||
+        (other.runtimeType == runtimeType && other is _$LoadingImpl);
+  }
+
+  @override
+  int get hashCode => runtimeType.hashCode;
+
+  @override
+  @optionalTypeArgs
+  TResult when<TResult extends Object?>({
+    required TResult Function() idle,
+    required TResult Function() loading,
+    required TResult Function(BotReply reply) success,
+    required TResult Function(String message) error,
+  }) {
+    return loading();
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult? whenOrNull<TResult extends Object?>({
+    TResult? Function()? idle,
+    TResult? Function()? loading,
+    TResult? Function(BotReply reply)? success,
+    TResult? Function(String message)? error,
+  }) {
+    return loading?.call();
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult maybeWhen<TResult extends Object?>({
+    TResult Function()? idle,
+    TResult Function()? loading,
+    TResult Function(BotReply reply)? success,
+    TResult Function(String message)? error,
+    required TResult orElse(),
+  }) {
+    if (loading != null) {
+      return loading();
+    }
+    return orElse();
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult map<TResult extends Object?>({
+    required TResult Function(_Idle value) idle,
+    required TResult Function(_Loading value) loading,
+    required TResult Function(_Success value) success,
+    required TResult Function(_Error value) error,
+  }) {
+    return loading(this);
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult? mapOrNull<TResult extends Object?>({
+    TResult? Function(_Idle value)? idle,
+    TResult? Function(_Loading value)? loading,
+    TResult? Function(_Success value)? success,
+    TResult? Function(_Error value)? error,
+  }) {
+    return loading?.call(this);
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult maybeMap<TResult extends Object?>({
+    TResult Function(_Idle value)? idle,
+    TResult Function(_Loading value)? loading,
+    TResult Function(_Success value)? success,
+    TResult Function(_Error value)? error,
+    required TResult orElse(),
+  }) {
+    if (loading != null) {
+      return loading(this);
+    }
+    return orElse();
+  }
+}
+
+abstract class _Loading implements ChatState {
+  const factory _Loading() = _$LoadingImpl;
+}
+
+/// @nodoc
+abstract class _$$SuccessImplCopyWith<$Res> {
+  factory _$$SuccessImplCopyWith(
+    _$SuccessImpl value,
+    $Res Function(_$SuccessImpl) then,
+  ) = __$$SuccessImplCopyWithImpl<$Res>;
+  @useResult
+  $Res call({BotReply reply});
+
+  $BotReplyCopyWith<$Res> get reply;
+}
+
+/// @nodoc
+class __$$SuccessImplCopyWithImpl<$Res>
+    extends _$ChatStateCopyWithImpl<$Res, _$SuccessImpl>
+    implements _$$SuccessImplCopyWith<$Res> {
+  __$$SuccessImplCopyWithImpl(
+    _$SuccessImpl _value,
+    $Res Function(_$SuccessImpl) _then,
+  ) : super(_value, _then);
+
+  /// Create a copy of ChatState
+  /// with the given fields replaced by the non-null parameter values.
+  @pragma('vm:prefer-inline')
+  @override
+  $Res call({Object? reply = null}) {
+    return _then(
+      _$SuccessImpl(
+        null == reply
+            ? _value.reply
+            : reply // ignore: cast_nullable_to_non_nullable
+                as BotReply,
+      ),
+    );
+  }
+
+  /// Create a copy of ChatState
+  /// with the given fields replaced by the non-null parameter values.
+  @override
+  @pragma('vm:prefer-inline')
+  $BotReplyCopyWith<$Res> get reply {
+    return $BotReplyCopyWith<$Res>(_value.reply, (value) {
+      return _then(_value.copyWith(reply: value));
+    });
+  }
+}
+
+/// @nodoc
+
+class _$SuccessImpl implements _Success {
+  const _$SuccessImpl(this.reply);
+
+  @override
+  final BotReply reply;
+
+  @override
+  String toString() {
+    return 'ChatState.success(reply: $reply)';
+  }
+
+  @override
+  bool operator ==(Object other) {
+    return identical(this, other) ||
+        (other.runtimeType == runtimeType &&
+            other is _$SuccessImpl &&
+            (identical(other.reply, reply) || other.reply == reply));
+  }
+
+  @override
+  int get hashCode => Object.hash(runtimeType, reply);
+
+  /// Create a copy of ChatState
+  /// with the given fields replaced by the non-null parameter values.
+  @JsonKey(includeFromJson: false, includeToJson: false)
+  @override
+  @pragma('vm:prefer-inline')
+  _$$SuccessImplCopyWith<_$SuccessImpl> get copyWith =>
+      __$$SuccessImplCopyWithImpl<_$SuccessImpl>(this, _$identity);
+
+  @override
+  @optionalTypeArgs
+  TResult when<TResult extends Object?>({
+    required TResult Function() idle,
+    required TResult Function() loading,
+    required TResult Function(BotReply reply) success,
+    required TResult Function(String message) error,
+  }) {
+    return success(reply);
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult? whenOrNull<TResult extends Object?>({
+    TResult? Function()? idle,
+    TResult? Function()? loading,
+    TResult? Function(BotReply reply)? success,
+    TResult? Function(String message)? error,
+  }) {
+    return success?.call(reply);
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult maybeWhen<TResult extends Object?>({
+    TResult Function()? idle,
+    TResult Function()? loading,
+    TResult Function(BotReply reply)? success,
+    TResult Function(String message)? error,
+    required TResult orElse(),
+  }) {
+    if (success != null) {
+      return success(reply);
+    }
+    return orElse();
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult map<TResult extends Object?>({
+    required TResult Function(_Idle value) idle,
+    required TResult Function(_Loading value) loading,
+    required TResult Function(_Success value) success,
+    required TResult Function(_Error value) error,
+  }) {
+    return success(this);
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult? mapOrNull<TResult extends Object?>({
+    TResult? Function(_Idle value)? idle,
+    TResult? Function(_Loading value)? loading,
+    TResult? Function(_Success value)? success,
+    TResult? Function(_Error value)? error,
+  }) {
+    return success?.call(this);
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult maybeMap<TResult extends Object?>({
+    TResult Function(_Idle value)? idle,
+    TResult Function(_Loading value)? loading,
+    TResult Function(_Success value)? success,
+    TResult Function(_Error value)? error,
+    required TResult orElse(),
+  }) {
+    if (success != null) {
+      return success(this);
+    }
+    return orElse();
+  }
+}
+
+abstract class _Success implements ChatState {
+  const factory _Success(final BotReply reply) = _$SuccessImpl;
+
+  BotReply get reply;
+
+  /// Create a copy of ChatState
+  /// with the given fields replaced by the non-null parameter values.
+  @JsonKey(includeFromJson: false, includeToJson: false)
+  _$$SuccessImplCopyWith<_$SuccessImpl> get copyWith =>
+      throw _privateConstructorUsedError;
+}
+
+/// @nodoc
+abstract class _$$ErrorImplCopyWith<$Res> {
+  factory _$$ErrorImplCopyWith(
+    _$ErrorImpl value,
+    $Res Function(_$ErrorImpl) then,
+  ) = __$$ErrorImplCopyWithImpl<$Res>;
+  @useResult
+  $Res call({String message});
+}
+
+/// @nodoc
+class __$$ErrorImplCopyWithImpl<$Res>
+    extends _$ChatStateCopyWithImpl<$Res, _$ErrorImpl>
+    implements _$$ErrorImplCopyWith<$Res> {
+  __$$ErrorImplCopyWithImpl(
+    _$ErrorImpl _value,
+    $Res Function(_$ErrorImpl) _then,
+  ) : super(_value, _then);
+
+  /// Create a copy of ChatState
+  /// with the given fields replaced by the non-null parameter values.
+  @pragma('vm:prefer-inline')
+  @override
+  $Res call({Object? message = null}) {
+    return _then(
+      _$ErrorImpl(
+        null == message
+            ? _value.message
+            : message // ignore: cast_nullable_to_non_nullable
+                as String,
+      ),
+    );
+  }
+}
+
+/// @nodoc
+
+class _$ErrorImpl implements _Error {
+  const _$ErrorImpl(this.message);
+
+  @override
+  final String message;
+
+  @override
+  String toString() {
+    return 'ChatState.error(message: $message)';
+  }
+
+  @override
+  bool operator ==(Object other) {
+    return identical(this, other) ||
+        (other.runtimeType == runtimeType &&
+            other is _$ErrorImpl &&
+            (identical(other.message, message) || other.message == message));
+  }
+
+  @override
+  int get hashCode => Object.hash(runtimeType, message);
+
+  /// Create a copy of ChatState
+  /// with the given fields replaced by the non-null parameter values.
+  @JsonKey(includeFromJson: false, includeToJson: false)
+  @override
+  @pragma('vm:prefer-inline')
+  _$$ErrorImplCopyWith<_$ErrorImpl> get copyWith =>
+      __$$ErrorImplCopyWithImpl<_$ErrorImpl>(this, _$identity);
+
+  @override
+  @optionalTypeArgs
+  TResult when<TResult extends Object?>({
+    required TResult Function() idle,
+    required TResult Function() loading,
+    required TResult Function(BotReply reply) success,
+    required TResult Function(String message) error,
+  }) {
+    return error(message);
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult? whenOrNull<TResult extends Object?>({
+    TResult? Function()? idle,
+    TResult? Function()? loading,
+    TResult? Function(BotReply reply)? success,
+    TResult? Function(String message)? error,
+  }) {
+    return error?.call(message);
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult maybeWhen<TResult extends Object?>({
+    TResult Function()? idle,
+    TResult Function()? loading,
+    TResult Function(BotReply reply)? success,
+    TResult Function(String message)? error,
+    required TResult orElse(),
+  }) {
+    if (error != null) {
+      return error(message);
+    }
+    return orElse();
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult map<TResult extends Object?>({
+    required TResult Function(_Idle value) idle,
+    required TResult Function(_Loading value) loading,
+    required TResult Function(_Success value) success,
+    required TResult Function(_Error value) error,
+  }) {
+    return error(this);
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult? mapOrNull<TResult extends Object?>({
+    TResult? Function(_Idle value)? idle,
+    TResult? Function(_Loading value)? loading,
+    TResult? Function(_Success value)? success,
+    TResult? Function(_Error value)? error,
+  }) {
+    return error?.call(this);
+  }
+
+  @override
+  @optionalTypeArgs
+  TResult maybeMap<TResult extends Object?>({
+    TResult Function(_Idle value)? idle,
+    TResult Function(_Loading value)? loading,
+    TResult Function(_Success value)? success,
+    TResult Function(_Error value)? error,
+    required TResult orElse(),
+  }) {
+    if (error != null) {
+      return error(this);
+    }
+    return orElse();
+  }
+}
+
+abstract class _Error implements ChatState {
+  const factory _Error(final String message) = _$ErrorImpl;
+
+  String get message;
+
+  /// Create a copy of ChatState
+  /// with the given fields replaced by the non-null parameter values.
+  @JsonKey(includeFromJson: false, includeToJson: false)
+  _$$ErrorImplCopyWith<_$ErrorImpl> get copyWith =>
+      throw _privateConstructorUsedError;
+}
diff --git a/lib/features/conversation/data/chat_models.freezed.dart b/lib/features/conversation/data/chat_models.freezed.dart
new file mode 100644
index 0000000..6a51e1f
--- /dev/null
+++ b/lib/features/conversation/data/chat_models.freezed.dart
@@ -0,0 +1,412 @@
+// coverage:ignore-file
+// GENERATED CODE - DO NOT MODIFY BY HAND
+// ignore_for_file: type=lint
+// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark
+
+part of 'chat_models.dart';
+
+// **************************************************************************
+// FreezedGenerator
+// **************************************************************************
+
+T _$identity<T>(T value) => value;
+
+final _privateConstructorUsedError = UnsupportedError(
+  'It seems like you constructed your class using `MyClass._()`. This constructor is only meant to be used by freezed and you are not supposed to need it nor use it.\nPlease check the documentation here for more information: https://github.com/rrousselGit/freezed#adding-getters-and-methods-to-our-models',
+);
+
+ChatCitation _$ChatCitationFromJson(Map<String, dynamic> json) {
+  return _ChatCitation.fromJson(json);
+}
+
+/// @nodoc
+mixin _$ChatCitation {
+  String get docId => throw _privateConstructorUsedError;
+  String get sectionKey => throw _privateConstructorUsedError;
+
+  /// Serializes this ChatCitation to a JSON map.
+  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
+
+  /// Create a copy of ChatCitation
+  /// with the given fields replaced by the non-null parameter values.
+  @JsonKey(includeFromJson: false, includeToJson: false)
+  $ChatCitationCopyWith<ChatCitation> get copyWith =>
+      throw _privateConstructorUsedError;
+}
+
+/// @nodoc
+abstract class $ChatCitationCopyWith<$Res> {
+  factory $ChatCitationCopyWith(
+    ChatCitation value,
+    $Res Function(ChatCitation) then,
+  ) = _$ChatCitationCopyWithImpl<$Res, ChatCitation>;
+  @useResult
+  $Res call({String docId, String sectionKey});
+}
+
+/// @nodoc
+class _$ChatCitationCopyWithImpl<$Res, $Val extends ChatCitation>
+    implements $ChatCitationCopyWith<$Res> {
+  _$ChatCitationCopyWithImpl(this._value, this._then);
+
+  // ignore: unused_field
+  final $Val _value;
+  // ignore: unused_field
+  final $Res Function($Val) _then;
+
+  /// Create a copy of ChatCitation
+  /// with the given fields replaced by the non-null parameter values.
+  @pragma('vm:prefer-inline')
+  @override
+  $Res call({Object? docId = null, Object? sectionKey = null}) {
+    return _then(
+      _value.copyWith(
+            docId:
+                null == docId
+                    ? _value.docId
+                    : docId // ignore: cast_nullable_to_non_nullable
+                        as String,
+            sectionKey:
+                null == sectionKey
+                    ? _value.sectionKey
+                    : sectionKey // ignore: cast_nullable_to_non_nullable
+                        as String,
+          )
+          as $Val,
+    );
+  }
+}
+
+/// @nodoc
+abstract class _$$ChatCitationImplCopyWith<$Res>
+    implements $ChatCitationCopyWith<$Res> {
+  factory _$$ChatCitationImplCopyWith(
+    _$ChatCitationImpl value,
+    $Res Function(_$ChatCitationImpl) then,
+  ) = __$$ChatCitationImplCopyWithImpl<$Res>;
+  @override
+  @useResult
+  $Res call({String docId, String sectionKey});
+}
+
+/// @nodoc
+class __$$ChatCitationImplCopyWithImpl<$Res>
+    extends _$ChatCitationCopyWithImpl<$Res, _$ChatCitationImpl>
+    implements _$$ChatCitationImplCopyWith<$Res> {
+  __$$ChatCitationImplCopyWithImpl(
+    _$ChatCitationImpl _value,
+    $Res Function(_$ChatCitationImpl) _then,
+  ) : super(_value, _then);
+
+  /// Create a copy of ChatCitation
+  /// with the given fields replaced by the non-null parameter values.
+  @pragma('vm:prefer-inline')
+  @override
+  $Res call({Object? docId = null, Object? sectionKey = null}) {
+    return _then(
+      _$ChatCitationImpl(
+        docId:
+            null == docId
+                ? _value.docId
+                : docId // ignore: cast_nullable_to_non_nullable
+                    as String,
+        sectionKey:
+            null == sectionKey
+                ? _value.sectionKey
+                : sectionKey // ignore: cast_nullable_to_non_nullable
+                    as String,
+      ),
+    );
+  }
+}
+
+/// @nodoc
+@JsonSerializable()
+class _$ChatCitationImpl implements _ChatCitation {
+  const _$ChatCitationImpl({required this.docId, required this.sectionKey});
+
+  factory _$ChatCitationImpl.fromJson(Map<String, dynamic> json) =>
+      _$$ChatCitationImplFromJson(json);
+
+  @override
+  final String docId;
+  @override
+  final String sectionKey;
+
+  @override
+  String toString() {
+    return 'ChatCitation(docId: $docId, sectionKey: $sectionKey)';
+  }
+
+  @override
+  bool operator ==(Object other) {
+    return identical(this, other) ||
+        (other.runtimeType == runtimeType &&
+            other is _$ChatCitationImpl &&
+            (identical(other.docId, docId) || other.docId == docId) &&
+            (identical(other.sectionKey, sectionKey) ||
+                other.sectionKey == sectionKey));
+  }
+
+  @JsonKey(includeFromJson: false, includeToJson: false)
+  @override
+  int get hashCode => Object.hash(runtimeType, docId, sectionKey);
+
+  /// Create a copy of ChatCitation
+  /// with the given fields replaced by the non-null parameter values.
+  @JsonKey(includeFromJson: false, includeToJson: false)
+  @override
+  @pragma('vm:prefer-inline')
+  _$$ChatCitationImplCopyWith<_$ChatCitationImpl> get copyWith =>
+      __$$ChatCitationImplCopyWithImpl<_$ChatCitationImpl>(this, _$identity);
+
+  @override
+  Map<String, dynamic> toJson() {
+    return _$$ChatCitationImplToJson(this);
+  }
+}
+
+abstract class _ChatCitation implements ChatCitation {
+  const factory _ChatCitation({
+    required final String docId,
+    required final String sectionKey,
+  }) = _$ChatCitationImpl;
+
+  factory _ChatCitation.fromJson(Map<String, dynamic> json) =
+      _$ChatCitationImpl.fromJson;
+
+  @override
+  String get docId;
+  @override
+  String get sectionKey;
+
+  /// Create a copy of ChatCitation
+  /// with the given fields replaced by the non-null parameter values.
+  @override
+  @JsonKey(includeFromJson: false, includeToJson: false)
+  _$$ChatCitationImplCopyWith<_$ChatCitationImpl> get copyWith =>
+      throw _privateConstructorUsedError;
+}
+
+BotReply _$BotReplyFromJson(Map<String, dynamic> json) {
+  return _BotReply.fromJson(json);
+}
+
+/// @nodoc
+mixin _$BotReply {
+  String get content => throw _privateConstructorUsedError;
+  List<ChatCitation> get citations => throw _privateConstructorUsedError;
+  String get lastVerified => throw _privateConstructorUsedError;
+
+  /// Serializes this BotReply to a JSON map.
+  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
+
+  /// Create a copy of BotReply
+  /// with the given fields replaced by the non-null parameter values.
+  @JsonKey(includeFromJson: false, includeToJson: false)
+  $BotReplyCopyWith<BotReply> get copyWith =>
+      throw _privateConstructorUsedError;
+}
+
+/// @nodoc
+abstract class $BotReplyCopyWith<$Res> {
+  factory $BotReplyCopyWith(BotReply value, $Res Function(BotReply) then) =
+      _$BotReplyCopyWithImpl<$Res, BotReply>;
+  @useResult
+  $Res call({
+    String content,
+    List<ChatCitation> citations,
+    String lastVerified,
+  });
+}
+
+/// @nodoc
+class _$BotReplyCopyWithImpl<$Res, $Val extends BotReply>
+    implements $BotReplyCopyWith<$Res> {
+  _$BotReplyCopyWithImpl(this._value, this._then);
+
+  // ignore: unused_field
+  final $Val _value;
+  // ignore: unused_field
+  final $Res Function($Val) _then;
+
+  /// Create a copy of BotReply
+  /// with the given fields replaced by the non-null parameter values.
+  @pragma('vm:prefer-inline')
+  @override
+  $Res call({
+    Object? content = null,
+    Object? citations = null,
+    Object? lastVerified = null,
+  }) {
+    return _then(
+      _value.copyWith(
+            content:
+                null == content
+                    ? _value.content
+                    : content // ignore: cast_nullable_to_non_nullable
+                        as String,
+            citations:
+                null == citations
+                    ? _value.citations
+                    : citations // ignore: cast_nullable_to_non_nullable
+                        as List<ChatCitation>,
+            lastVerified:
+                null == lastVerified
+                    ? _value.lastVerified
+                    : lastVerified // ignore: cast_nullable_to_non_nullable
+                        as String,
+          )
+          as $Val,
+    );
+  }
+}
+
+/// @nodoc
+abstract class _$$BotReplyImplCopyWith<$Res>
+    implements $BotReplyCopyWith<$Res> {
+  factory _$$BotReplyImplCopyWith(
+    _$BotReplyImpl value,
+    $Res Function(_$BotReplyImpl) then,
+  ) = __$$BotReplyImplCopyWithImpl<$Res>;
+  @override
+  @useResult
+  $Res call({
+    String content,
+    List<ChatCitation> citations,
+    String lastVerified,
+  });
+}
+
+/// @nodoc
+class __$$BotReplyImplCopyWithImpl<$Res>
+    extends _$BotReplyCopyWithImpl<$Res, _$BotReplyImpl>
+    implements _$$BotReplyImplCopyWith<$Res> {
+  __$$BotReplyImplCopyWithImpl(
+    _$BotReplyImpl _value,
+    $Res Function(_$BotReplyImpl) _then,
+  ) : super(_value, _then);
+
+  /// Create a copy of BotReply
+  /// with the given fields replaced by the non-null parameter values.
+  @pragma('vm:prefer-inline')
+  @override
+  $Res call({
+    Object? content = null,
+    Object? citations = null,
+    Object? lastVerified = null,
+  }) {
+    return _then(
+      _$BotReplyImpl(
+        content:
+            null == content
+                ? _value.content
+                : content // ignore: cast_nullable_to_non_nullable
+                    as String,
+        citations:
+            null == citations
+                ? _value._citations
+                : citations // ignore: cast_nullable_to_non_nullable
+                    as List<ChatCitation>,
+        lastVerified:
+            null == lastVerified
+                ? _value.lastVerified
+                : lastVerified // ignore: cast_nullable_to_non_nullable
+                    as String,
+      ),
+    );
+  }
+}
+
+/// @nodoc
+@JsonSerializable()
+class _$BotReplyImpl implements _BotReply {
+  const _$BotReplyImpl({
+    required this.content,
+    final List<ChatCitation> citations = const <ChatCitation>[],
+    required this.lastVerified,
+  }) : _citations = citations;
+
+  factory _$BotReplyImpl.fromJson(Map<String, dynamic> json) =>
+      _$$BotReplyImplFromJson(json);
+
+  @override
+  final String content;
+  final List<ChatCitation> _citations;
+  @override
+  @JsonKey()
+  List<ChatCitation> get citations {
+    if (_citations is EqualUnmodifiableListView) return _citations;
+    // ignore: implicit_dynamic_type
+    return EqualUnmodifiableListView(_citations);
+  }
+
+  @override
+  final String lastVerified;
+
+  @override
+  String toString() {
+    return 'BotReply(content: $content, citations: $citations, lastVerified: $lastVerified)';
+  }
+
+  @override
+  bool operator ==(Object other) {
+    return identical(this, other) ||
+        (other.runtimeType == runtimeType &&
+            other is _$BotReplyImpl &&
+            (identical(other.content, content) || other.content == content) &&
+            const DeepCollectionEquality().equals(
+              other._citations,
+              _citations,
+            ) &&
+            (identical(other.lastVerified, lastVerified) ||
+                other.lastVerified == lastVerified));
+  }
+
+  @JsonKey(includeFromJson: false, includeToJson: false)
+  @override
+  int get hashCode => Object.hash(
+    runtimeType,
+    content,
+    const DeepCollectionEquality().hash(_citations),
+    lastVerified,
+  );
+
+  /// Create a copy of BotReply
+  /// with the given fields replaced by the non-null parameter values.
+  @JsonKey(includeFromJson: false, includeToJson: false)
+  @override
+  @pragma('vm:prefer-inline')
+  _$$BotReplyImplCopyWith<_$BotReplyImpl> get copyWith =>
+      __$$BotReplyImplCopyWithImpl<_$BotReplyImpl>(this, _$identity);
+
+  @override
+  Map<String, dynamic> toJson() {
+    return _$$BotReplyImplToJson(this);
+  }
+}
+
+abstract class _BotReply implements BotReply {
+  const factory _BotReply({
+    required final String content,
+    final List<ChatCitation> citations,
+    required final String lastVerified,
+  }) = _$BotReplyImpl;
+
+  factory _BotReply.fromJson(Map<String, dynamic> json) =
+      _$BotReplyImpl.fromJson;
+
+  @override
+  String get content;
+  @override
+  List<ChatCitation> get citations;
+  @override
+  String get lastVerified;
+
+  /// Create a copy of BotReply
+  /// with the given fields replaced by the non-null parameter values.
+  @override
+  @JsonKey(includeFromJson: false, includeToJson: false)
+  _$$BotReplyImplCopyWith<_$BotReplyImpl> get copyWith =>
+      throw _privateConstructorUsedError;
+}
diff --git a/lib/features/conversation/data/chat_models.g.dart b/lib/features/conversation/data/chat_models.g.dart
new file mode 100644
index 0000000..3c9f0e4
--- /dev/null
+++ b/lib/features/conversation/data/chat_models.g.dart
@@ -0,0 +1,37 @@
+// GENERATED CODE - DO NOT MODIFY BY HAND
+
+part of 'chat_models.dart';
+
+// **************************************************************************
+// JsonSerializableGenerator
+// **************************************************************************
+
+_$ChatCitationImpl _$$ChatCitationImplFromJson(Map<String, dynamic> json) =>
+    _$ChatCitationImpl(
+      docId: json['docId'] as String,
+      sectionKey: json['sectionKey'] as String,
+    );
+
+Map<String, dynamic> _$$ChatCitationImplToJson(_$ChatCitationImpl instance) =>
+    <String, dynamic>{
+      'docId': instance.docId,
+      'sectionKey': instance.sectionKey,
+    };
+
+_$BotReplyImpl _$$BotReplyImplFromJson(Map<String, dynamic> json) =>
+    _$BotReplyImpl(
+      content: json['content'] as String,
+      citations:
+          (json['citations'] as List<dynamic>?)
+              ?.map((e) => ChatCitation.fromJson(e as Map<String, dynamic>))
+              .toList() ??
+          const <ChatCitation>[],
+      lastVerified: json['lastVerified'] as String,
+    );
+
+Map<String, dynamic> _$$BotReplyImplToJson(_$BotReplyImpl instance) =>
+    <String, dynamic>{
+      'content': instance.content,
+      'citations': instance.citations,
+      'lastVerified': instance.lastVerified,
+    };
diff --git a/lib/features/conversation/ui/conversation_page.dart b/lib/features/conversation/ui/conversation_page.dart
index 46c27f1..1e1fcba 100644
--- a/lib/features/conversation/ui/conversation_page.dart
+++ b/lib/features/conversation/ui/conversation_page.dart
@@ -11,7 +11,7 @@ import '../../../ui/components/appear.dart';
 import 'package:flutter_bloc/flutter_bloc.dart';
 import '../../conversation/bloc/chat_cubit.dart';
 import '../../conversation/data/chat_repository.dart';
-import '../../conversation/data/chat_models.dart' as model;
+import '../../conversation/data/chat_models.dart';
 
 class ConversationPage extends StatefulWidget {
   const ConversationPage({super.key});
@@ -288,7 +288,7 @@ class _ConversationPageState extends State<ConversationPage> {
     return _typingRowIndex!;
   }
 
-  void _replaceTypingWithReply(int typingIndex, model.BotReply reply) {
+  void _replaceTypingWithReply(int typingIndex, BotReply reply) {
     // Convert model citations to UI component citations
     final cites = reply.citations
         .map((c) => Citation(c.docId, c.sectionKey))
@@ -446,7 +446,8 @@ class _ConversationPageState extends State<ConversationPage> {
         ),
       ),
     ),
-  );
+      ),
+    );
   }
 
   // Question flow (full v1 per INTAKE_FLOW.md)
diff --git a/pubspec.lock b/pubspec.lock
index 2008e41..b2e58a9 100644
--- a/pubspec.lock
+++ b/pubspec.lock
@@ -289,7 +289,7 @@ packages:
     source: hosted
     version: "2.3.2"
   http:
-    dependency: transitive
+    dependency: "direct main"
     description:
       name: http
       sha256: bb2ce4590bc2667c96f318d68cac1b5a7987ec819351d32b1c987239a815e007
-- 
2.39.5 (Apple Git-154)


From 923c708f9183bc45a604c168c4e6f90acb55f4b6 Mon Sep 17 00:00:00 2001
From: codex <codex@example.com>
Date: Wed, 3 Sep 2025 16:37:45 +0900
Subject: [PATCH 11/13] refactor(conversation): separate intake logic into
 ConversationCubit; UI listens and renders; add MultiBlocProvider and progress
 from state

---
 .../conversation/bloc/conversation_cubit.dart | 442 ++++++++++++++++++
 .../conversation/ui/conversation_page.dart    | 151 +++---
 2 files changed, 526 insertions(+), 67 deletions(-)
 create mode 100644 lib/features/conversation/bloc/conversation_cubit.dart

diff --git a/lib/features/conversation/bloc/conversation_cubit.dart b/lib/features/conversation/bloc/conversation_cubit.dart
new file mode 100644
index 0000000..465c7d6
--- /dev/null
+++ b/lib/features/conversation/bloc/conversation_cubit.dart
@@ -0,0 +1,442 @@
+import 'package:flutter_bloc/flutter_bloc.dart';
+import 'package:flutter/foundation.dart';
+import '../../../common/analytics/analytics.dart';
+import '../../conversation/ui/../../ui/components/result_card.dart';
+import '../../conversation/ui/../../ui/components/intake_question.dart';
+
+enum ConversationPhase { survey, intake, qna }
+
+@immutable
+class ConversationQuestion {
+  final String qid;
+  final String label;
+  final List<Choice> choices;
+  final int index;
+  final int total;
+  final bool isSurvey;
+  const ConversationQuestion({
+    required this.qid,
+    required this.label,
+    required this.choices,
+    required this.index,
+    required this.total,
+    required this.isSurvey,
+  });
+}
+
+@immutable
+class ConversationResult {
+  final RulingStatus status;
+  final String tldr;
+  final List<ReasonItem> reasons;
+  final List<String> nextSteps;
+  final String lastVerified;
+  const ConversationResult(this.status, this.tldr, this.reasons, this.nextSteps, this.lastVerified);
+}
+
+@immutable
+class ConversationState {
+  final ConversationPhase phase;
+  final bool awaitingChoice;
+  final ConversationQuestion? question;
+  final ConversationResult? result;
+  final String? message; // optional bot message to show
+  const ConversationState({
+    required this.phase,
+    required this.awaitingChoice,
+    this.question,
+    this.result,
+    this.message,
+  });
+
+  ConversationState copyWith({
+    ConversationPhase? phase,
+    bool? awaitingChoice,
+    ConversationQuestion? question,
+    ConversationResult? result,
+    String? message,
+  }) => ConversationState(
+        phase: phase ?? this.phase,
+        awaitingChoice: awaitingChoice ?? this.awaitingChoice,
+        question: question,
+        result: result,
+        message: message,
+      );
+}
+
+class ConversationCubit extends Cubit<ConversationState> {
+  static const _unknown = '__unknown__';
+  int _step = 0;
+  final Map<String, String> _answers = {};
+  DateTime _phaseStartedAt = DateTime.now();
+
+  ConversationCubit() : super(const ConversationState(phase: ConversationPhase.survey, awaitingChoice: false));
+
+  void start() {
+    _phaseStartedAt = DateTime.now();
+    _emitQuestion(phase: ConversationPhase.survey, step: 0);
+  }
+
+  void answer(String qid, String value) {
+    final phase = state.phase;
+    _answers[qid] = value;
+    final list = phase == ConversationPhase.survey ? _surveyFlow : _flow;
+    if (_step < list.length - 1) {
+      _step += 1;
+      _emitQuestion(phase: phase, step: _step);
+    } else {
+      if (phase == ConversationPhase.survey) {
+        final surveyDuration = DateTime.now().difference(_phaseStartedAt).inMilliseconds;
+        Analytics.instance.quickSurveyComplete(_surveyFlow.length, surveyDuration);
+        // Transition to intake
+        _step = 0;
+        _phaseStartedAt = DateTime.now();
+        emit(ConversationState(
+          phase: ConversationPhase.intake,
+          awaitingChoice: false,
+          question: null,
+          result: null,
+          message: 'ê°ì‚¬í•©ë‹ˆë‹¤. ë‹µë³€ì„ ë°˜ì˜í•´ ì˜ˆë¹„íŒì •ì„ ì‹œì‘í• ê²Œìš”.',
+        ));
+        Analytics.instance.intakeStart();
+        // Next question (intake)
+        _emitQuestion(phase: ConversationPhase.intake, step: 0);
+      } else {
+        _evaluateAndEmit();
+      }
+    }
+  }
+
+  void _emitQuestion({required ConversationPhase phase, required int step}) {
+    final list = phase == ConversationPhase.survey ? _surveyFlow : _flow;
+    final q = list[step];
+    final cq = ConversationQuestion(
+      qid: q.qid,
+      label: q.label,
+      choices: q.choices,
+      index: step + 1,
+      total: list.length,
+      isSurvey: phase == ConversationPhase.survey,
+    );
+    emit(ConversationState(phase: phase, awaitingChoice: true, question: cq, result: null, message: null));
+  }
+
+  void _evaluateAndEmit() {
+    // Unknowns
+    final unknowns = _answers.entries
+        .where((e) => e.value == _unknown && !_isSurveyQid(e.key))
+        .map((e) => e.key)
+        .toList();
+    if (unknowns.isNotEmpty) {
+      final reasons = unknowns.map((qid) => ReasonItem(Icons.help_outline, _unknownLabel(qid), 'í™•ì¸ë¶ˆê°€')).toList();
+      _emitResult(ConversationResult(
+        RulingStatus.notPossibleInfo,
+        'ë‹¤ìŒ ì •ë³´ê°€ ì—†ì–´ íŒì • ë¶ˆê°€ì…ë‹ˆë‹¤.',
+        reasons,
+        const ['ì„¸ëŒ€ì£¼: ì •ë¶€24 í™•ì¸', 'ë³´ì¦ê¸ˆ: ê³„ì•½ì„œ í™•ì¸', 'ê·¼ì €ë‹¹: ë“±ê¸°ë¶€ë“±ë³¸ ì—´ëŒ'],
+        '2025-09-02',
+      ), hasUnknown: true, statusKey: 'not_possible_info');
+      return;
+    }
+
+    // Disqualifier: A1 == 1ì£¼íƒ
+    if (_answers['A1'] == 'onehome') {
+      _emitResult(
+        const ConversationResult(
+          RulingStatus.notPossibleDisq,
+          'ì•„ë˜ ê²°ê²© ì‚¬ìœ ë¡œ ì‹ ì²­ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.',
+          [ReasonItem(Icons.cancel, 'ë¬´ì£¼íƒ ìš”ê±´ ë¶ˆì¶©ì¡±', 'ë¯¸ì¶©ì¡±')],
+          ['ì¡°ê±´ ë³€ê²½(ë³´ì¦ê¸ˆ ì¡°ì •) ë˜ëŠ” íƒ€ ê¸°ê´€ ê²€í† '],
+          '2025-09-02',
+        ),
+        hasUnknown: false,
+        statusKey: 'not_possible_disq',
+      );
+      return;
+    }
+
+    // Disqualifier: ì¤‘ëŒ€í•œ ì‹ ìš© ë¬¸ì œ(A7)
+    if (_answers['A7'] == 'credit_severe') {
+      _emitResult(
+        const ConversationResult(
+          RulingStatus.notPossibleDisq,
+          'ì•„ë˜ ê²°ê²© ì‚¬ìœ ë¡œ ì‹ ì²­ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.',
+          [ReasonItem(Icons.cancel, 'ì¤‘ëŒ€í•œ ì‹ ìš© ë¬¸ì œ(ì¥ê¸°ì—°ì²´/íšŒìƒ/íŒŒì‚°/ë©´ì±…)', 'ë¯¸ì¶©ì¡±')],
+          ['ì‹ ìš© ìƒíƒœ í™•ì¸ í›„ ì¬ì‹œë„ ë˜ëŠ” íƒ€ ìƒí’ˆ ê²€í† '],
+          '2025-09-02',
+        ),
+        hasUnknown: false,
+        statusKey: 'not_possible_disq',
+      );
+      return;
+    }
+
+    // Otherwise, possible
+    final reasons = <ReasonItem>[
+      const ReasonItem(Icons.check_circle, 'ê°€êµ¬/ì„¸ëŒ€: (ì¶©ì¡±)', 'ì¶©ì¡±'),
+      if (_answers.containsKey('A3')) const ReasonItem(Icons.check_circle, 'ì†Œë“ í˜•íƒœ: (ì¶©ì¡±)', 'ì¶©ì¡±'),
+      if (_answers.containsKey('A4')) const ReasonItem(Icons.check_circle, 'ì†Œë“ êµ¬ê°„: (ì¶©ì¡±)', 'ì¶©ì¡±'),
+      if (_answers.containsKey('P1')) const ReasonItem(Icons.check_circle, 'ì£¼íƒ ìœ í˜•: (ì¶©ì¡±)', 'ì¶©ì¡±'),
+      if (_answers.containsKey('P2')) const ReasonItem(Icons.check_circle, 'ì „ìš©ë©´ì : (ì¶©ì¡±)', 'ì¶©ì¡±'),
+      if (_answers.containsKey('P3')) const ReasonItem(Icons.check_circle, 'ì§€ì—­: (ì¶©ì¡±)', 'ì¶©ì¡±'),
+      if (_answers.containsKey('P4')) const ReasonItem(Icons.check_circle, 'ë³´ì¦ê¸ˆ: (ì¶©ì¡±)', 'ì¶©ì¡±'),
+      if (_answers['P7'] == 'encumbrance_yes') const ReasonItem(Icons.warning_amber, 'ê·¼ì €ë‹¹ ìˆìŒ â†’ ë“±ê¸° í™•ì¸ í•„ìš”', 'ì£¼ì˜'),
+    ];
+    _emitResult(
+      const ConversationResult(
+        RulingStatus.possible,
+        'ì˜ˆë¹„íŒì • ê²°ê³¼, â€˜í•´ë‹¹â€™í•©ë‹ˆë‹¤. ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.',
+        [], // reasons replaced below to keep const
+        ['ì‹ ë¶„ì¦Â·ê°€ì¡±/í˜¼ì¸ê´€ê³„Â·ì†Œë“ ì¦ë¹™ ì¤€ë¹„', 'ì„ëŒ€ì¸ ë“±ê¸°ë¶€ë“±ë³¸/ê³„ì•½ì„œ ì‚¬ë³¸', 'ì€í–‰ ìƒë‹´ â†’ ì‹¬ì‚¬ â†’ ìŠ¹ì¸ â†’ ì‹¤í–‰'],
+        '2025-09-02',
+      ),
+      hasUnknown: false,
+      statusKey: 'possible',
+      overrideReasons: reasons,
+    );
+  }
+
+  void _emitResult(ConversationResult result,
+      {required bool hasUnknown, required String statusKey, List<ReasonItem>? overrideReasons}) {
+    final intakeDuration = DateTime.now().difference(_phaseStartedAt).inMilliseconds;
+    Analytics.instance.intakeComplete(_flow.length, intakeDuration, hasUnknown, statusKey);
+    Analytics.instance.rulingShown(statusKey);
+    final r = overrideReasons == null
+        ? result
+        : ConversationResult(result.status, result.tldr, overrideReasons, result.nextSteps, result.lastVerified);
+    emit(ConversationState(
+      phase: ConversationPhase.qna,
+      awaitingChoice: false,
+      question: null,
+      result: r,
+      message: null,
+    ));
+  }
+
+  String _unknownLabel(String qid) {
+    switch (qid) {
+      case 'A1':
+        return 'ì„¸ëŒ€ì£¼ ì—¬ë¶€';
+      case 'A2':
+        return 'í˜¼ì¸/ë¶€ì–‘ ìƒíƒœ';
+      case 'A3':
+        return 'ì†Œë“ í˜•íƒœ';
+      case 'A4':
+        return 'ì†Œë“ êµ¬ê°„';
+      case 'A5':
+        return 'ì¬ì§/ì‚¬ì—… ê¸°ê°„';
+      case 'A6':
+        return 'ê¸°ì¡´ ëŒ€ì¶œ/ë³´ì¦';
+      case 'A7':
+        return 'ì‹ ìš©/ì—°ì²´ ì´ë ¥';
+      case 'P1':
+        return 'ì£¼íƒ ìœ í˜•';
+      case 'P2':
+        return 'ì „ìš©ë©´ì ';
+      case 'P3':
+        return 'ì§€ì—­';
+      case 'P4':
+        return 'ë³´ì¦ê¸ˆ(ë˜ëŠ” ë³´ì¦ê¸ˆ+ì›”ì„¸)';
+      case 'P5':
+        return 'ê³„ì•½ ìƒíƒœ';
+      case 'P6':
+        return 'ì…ì£¼ ì˜ˆì •';
+      case 'P7':
+        return 'ë“±ê¸° ê·¼ì €ë‹¹';
+      case 'S1':
+        return 'ìš°ëŒ€/íŠ¹ë¡€';
+      default:
+        return qid;
+    }
+  }
+
+  bool _isSurveyQid(String qid) => qid.startsWith('QS');
+
+  // Question flow (moved from UI)
+  static final List<_Q> _flow = [
+    _Q(
+      qid: 'A1',
+      label: 'í˜„ì¬ ë¬´ì£¼íƒì´ë©° ì„¸ëŒ€ì£¼ì´ì‹ ê°€ìš”?',
+      choices: const [
+        Choice(value: 'owner', text: 'ë¬´ì£¼íƒÂ·ì„¸ëŒ€ì£¼'),
+        Choice(value: 'member', text: 'ë¬´ì£¼íƒÂ·ì„¸ëŒ€ì›'),
+        Choice(value: 'onehome', text: '1ì£¼íƒ'),
+      ],
+    ),
+    _Q(
+      qid: 'A2',
+      label: 'í˜¼ì¸/ë¶€ì–‘ ìƒíƒœë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.',
+      choices: const [
+        Choice(value: 'single', text: 'ë¯¸í˜¼'),
+        Choice(value: 'newly', text: 'ì‹ í˜¼(í˜¼ì¸ 7ë…„ ì´ë‚´)'),
+        Choice(value: 'children', text: 'ìë…€ ìˆìŒ'),
+      ],
+    ),
+    _Q(
+      qid: 'A3',
+      label: 'ì†Œë“ í˜•íƒœë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.',
+      choices: const [
+        Choice(value: 'work', text: 'ê·¼ë¡œ'),
+        Choice(value: 'biz', text: 'ì‚¬ì—…'),
+        Choice(value: 'etc', text: 'ê¸°íƒ€'),
+      ],
+    ),
+    _Q(
+      qid: 'A4',
+      label: 'ì—°ê°„ ì†Œë“ êµ¬ê°„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.',
+      choices: const [
+        Choice(value: 'inc1', text: 'ë‚´ë¶€ êµ¬ê°„ 1'),
+        Choice(value: 'inc2', text: 'ë‚´ë¶€ êµ¬ê°„ 2'),
+        Choice(value: 'inc3', text: 'ë‚´ë¶€ êµ¬ê°„ 3'),
+        Choice(value: 'inc4', text: 'ë‚´ë¶€ êµ¬ê°„ 4'),
+      ],
+    ),
+    _Q(
+      qid: 'A5',
+      label: 'í˜„ì¬ ì¬ì§/ì‚¬ì—… ê¸°ê°„ì€ ì–¼ë§ˆë‚˜ ë˜ë‚˜ìš”?',
+      choices: const [
+        Choice(value: 'm0_6', text: '0~6ê°œì›”'),
+        Choice(value: 'm7_12', text: '7~12ê°œì›”'),
+        Choice(value: 'm13_24', text: '13~24ê°œì›”'),
+        Choice(value: 'm24p', text: '24ê°œì›” ì´ìƒ'),
+      ],
+    ),
+    _Q(
+      qid: 'A6',
+      label: 'ë³´ìœ  ì¤‘ì¸ ëŒ€ì¶œ/ë³´ì¦ì´ ìˆë‚˜ìš”?',
+      choices: const [
+        Choice(value: 'jeonse', text: 'ì „ì„¸ë³´ì¦'),
+        Choice(value: 'mtg', text: 'ì£¼ë‹´ëŒ€'),
+        Choice(value: 'credit', text: 'ì‹ ìš©'),
+        Choice(value: 'none', text: 'ì—†ìŒ'),
+      ],
+    ),
+    _Q(
+      qid: 'A7',
+      label: 'ìµœê·¼ ì—°ì²´Â·íšŒìƒÂ·íŒŒì‚°Â·ë©´ì±… ì´ë ¥ì´ ìˆë‚˜ìš”?',
+      choices: const [
+        Choice(value: 'credit_ok', text: 'ë¬¸ì œ ì—†ìŒ'),
+        Choice(value: 'credit_recent', text: 'ìµœê·¼ ì—°ì²´'),
+        Choice(value: 'credit_severe', text: 'ì¥ê¸°ì—°ì²´/íšŒìƒ/íŒŒì‚°/ë©´ì±…'),
+      ],
+    ),
+    _Q(
+      qid: 'P1',
+      label: 'ì£¼íƒ ìœ í˜•ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.',
+      choices: const [
+        Choice(value: 'apt', text: 'ì•„íŒŒíŠ¸'),
+        Choice(value: 'officetel', text: 'ì˜¤í”¼ìŠ¤í…”'),
+        Choice(value: 'multifam', text: 'ë‹¤ê°€êµ¬'),
+        Choice(value: 'villa', text: 'ì—°ë¦½Â·ë‹¤ì„¸ëŒ€'),
+        Choice(value: 'one_room', text: 'ì›ë£¸'),
+        Choice(value: 'etc', text: 'ê¸°íƒ€'),
+      ],
+    ),
+    _Q(
+      qid: 'P2',
+      label: 'ì „ìš©ë©´ì  ë²”ìœ„ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.',
+      choices: const [
+        Choice(value: 'fa_le40', text: 'â‰¤ 40ã¡'),
+        Choice(value: 'fa_41_60', text: '41â€“60ã¡'),
+        Choice(value: 'fa_61_85', text: '61â€“85ã¡'),
+        Choice(value: 'fa_gt85', text: '85ã¡ ì´ˆê³¼'),
+      ],
+    ),
+    _Q(
+      qid: 'P3',
+      label: 'ì§€ì—­ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.',
+      choices: const [
+        Choice(value: 'metro', text: 'ìˆ˜ë„ê¶Œ'),
+        Choice(value: 'metrocity', text: 'ê´‘ì—­ì‹œ'),
+        Choice(value: 'other', text: 'ê¸°íƒ€'),
+      ],
+    ),
+    _Q(
+      qid: 'P4',
+      label: 'ì „ì„¸ë³´ì¦ê¸ˆ(ë˜ëŠ” ë³´ì¦ê¸ˆ+ì›”ì„¸)ì„ ì•Œë ¤ì£¼ì„¸ìš”.',
+      choices: const [
+        Choice(value: 'dep_le1', text: '1ì–µ ì´í•˜'),
+        Choice(value: 'dep_1_2', text: '1~2ì–µ'),
+        Choice(value: 'dep_2_3', text: '2~3ì–µ'),
+        Choice(value: 'dep_gt3', text: '3ì–µ ì´ìƒ'),
+      ],
+    ),
+    _Q(
+      qid: 'P5',
+      label: 'ê³„ì•½ ìƒíƒœë¥¼ ì•Œë ¤ì£¼ì„¸ìš”.',
+      choices: const [
+        Choice(value: 'pre', text: 'ê³„ì•½ ì „'),
+        Choice(value: 'precontract', text: 'ê°€ê³„ì•½'),
+        Choice(value: 'contract', text: 'ë³¸ê³„ì•½'),
+      ],
+    ),
+    _Q(
+      qid: 'P6',
+      label: 'ì…ì£¼ ì˜ˆì • ì‹œì ì„ ì•Œë ¤ì£¼ì„¸ìš”.',
+      choices: const [
+        Choice(value: 'w1', text: '1ì£¼ ë‚´'),
+        Choice(value: 'w2_4', text: '2~4ì£¼'),
+        Choice(value: 'm1_3', text: '1~3ê°œì›”'),
+        Choice(value: 'm3p', text: '3ê°œì›”+'),
+      ],
+    ),
+    _Q(
+      qid: 'P7',
+      label: 'ë“±ê¸°ìƒ ê·¼ì €ë‹¹ì´ ìˆë‚˜ìš”?',
+      choices: const [
+        Choice(value: 'encumbrance_yes', text: 'ìˆìŒ'),
+        Choice(value: 'encumbrance_no', text: 'ì—†ìŒ'),
+      ],
+    ),
+    _Q(
+      qid: 'S1',
+      label: 'ìš°ëŒ€/íŠ¹ë¡€ì— í•´ë‹¹ë˜ë‚˜ìš”?',
+      choices: const [
+        Choice(value: 'youth', text: 'ì²­ë…„'),
+        Choice(value: 'newly', text: 'ì‹ í˜¼'),
+        Choice(value: 'multi', text: 'ë‹¤ìë…€'),
+        Choice(value: 'lowinc', text: 'ì €ì†Œë“'),
+        Choice(value: 'none', text: 'í•´ë‹¹ ì—†ìŒ'),
+      ],
+    ),
+  ];
+
+  static final List<_Q> _surveyFlow = [
+    const _Q(
+      qid: 'QS1',
+      label: 'ì–¸ì œê¹Œì§€ ì¤€ë¹„ê°€ í•„ìš”í•˜ì‹ ê°€ìš”?',
+      choices: [
+        Choice(value: 'soon', text: '2ì£¼ ì´ë‚´'),
+        Choice(value: 'month1', text: '1ê°œì›” ì´ë‚´'),
+        Choice(value: 'flex', text: 'ìœ ì—°í•¨'),
+      ],
+    ),
+    const _Q(
+      qid: 'QS2',
+      label: 'ì–´ë–¤ ì •ë³´ê°€ ê°€ì¥ ê¶ê¸ˆí•˜ì‹ ê°€ìš”?',
+      choices: [
+        Choice(value: 'elig', text: 'ìê²©'),
+        Choice(value: 'limit', text: 'í•œë„'),
+        Choice(value: 'docs', text: 'ì„œë¥˜/ì ˆì°¨'),
+      ],
+    ),
+    const _Q(
+      qid: 'QS3',
+      label: 'ì£¼ ê´€ì‹¬ ì§€ì—­ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.',
+      choices: [
+        Choice(value: 'metro', text: 'ìˆ˜ë„ê¶Œ'),
+        Choice(value: 'metrocity', text: 'ê´‘ì—­ì‹œ'),
+        Choice(value: 'other', text: 'ê¸°íƒ€'),
+      ],
+    ),
+  ];
+}
+
+@immutable
+class _Q {
+  final String qid;
+  final String label;
+  final List<Choice> choices;
+  const _Q({required this.qid, required this.label, required this.choices});
+}
+
diff --git a/lib/features/conversation/ui/conversation_page.dart b/lib/features/conversation/ui/conversation_page.dart
index 1e1fcba..5e3c4e6 100644
--- a/lib/features/conversation/ui/conversation_page.dart
+++ b/lib/features/conversation/ui/conversation_page.dart
@@ -73,49 +73,16 @@ class _ConversationPageState extends State<ConversationPage> {
 
   void _onChoiceSelected(String qid, String? value) {
     if (value == null) return;
-    // Resolve the question from the current phase's list (survey vs intake)
-    final list = _phase == _Phase.survey ? _surveyFlow : _flow;
-    final q = list.firstWhere(
-      (e) => e.qid == qid,
-      orElse: () => _Question(qid: qid, label: qid, choices: const []),
-    );
-    final label = _labelFor(q, value);
+    final label = value == _unknown
+        ? 'ëª¨ë¦„'
+        : (context.read<ConversationCubit>().state.question?.choices.firstWhere((c) => c.value == value).text ?? value);
     _appendUserText(label);
-    _answers[qid] = value;
-    final isUnknown = value == _unknown;
-    if (_phase == _Phase.intake) {
-      Analytics.instance.intakeAnswer(qid, value, isUnknown);
-    }
     setState(() => _awaitingChoice = false);
-
-    // Advance within the current phase
-    if (_step < list.length - 1) {
-      _step += 1;
-      _askCurrent();
-    } else {
-      if (_phase == _Phase.survey) {
-        // Survey done â†’ transition to intake
-        final surveyDuration = DateTime.now().difference(_phaseStartedAt).inMilliseconds;
-        Analytics.instance.quickSurveyComplete(_surveyFlow.length, surveyDuration);
-        _appendBotText('ê°ì‚¬í•©ë‹ˆë‹¤. ë‹µë³€ì„ ë°˜ì˜í•´ ì˜ˆë¹„íŒì •ì„ ì‹œì‘í• ê²Œìš”.');
-        setState(() {
-          _phase = _Phase.intake;
-          _step = 0;
-          _phaseStartedAt = DateTime.now();
-        });
-        Analytics.instance.intakeStart();
-        _rows.add(_Row.botRich(const TypingIndicator()));
-        setState(() {});
-        Future.delayed(const Duration(milliseconds: 400), _askCurrent);
-      } else {
-        _evaluateAndShow();
-      }
-    }
+    context.read<ConversationCubit>().answer(qid, value);
   }
 
   String _labelFor(_Question q, String value) {
     if (value == _unknown) return 'ëª¨ë¦„';
-    // Safe lookup: fall back to raw value if not found
     final match = q.choices.where((c) => c.value == value);
     return match.isNotEmpty ? match.first.text : value;
   }
@@ -312,28 +279,64 @@ class _ConversationPageState extends State<ConversationPage> {
   @override
   Widget build(BuildContext context) {
     final spacing = context.spacing;
-    return BlocProvider<ChatCubit>(
-      create: (ctx) => ChatCubit(RepositoryProvider.of(ctx)),
-      child: BlocListener<ChatCubit, ChatState>(
-        listener: (context, state) {
-          state.maybeWhen(
-            success: (reply) {
-              if (_typingRowIndex != null) {
-                _replaceTypingWithReply(_typingRowIndex!, reply);
-                Analytics.instance
-                    .qnaAnswer(true, reply.lastVerified.isEmpty ? '2025-09-02' : reply.lastVerified);
-                _typingRowIndex = null;
-              }
+    return MultiBlocProvider(
+      providers: [
+        BlocProvider<ChatCubit>(create: (ctx) => ChatCubit(RepositoryProvider.of(ctx))),
+        BlocProvider<ConversationCubit>(create: (_) => ConversationCubit()),
+      ],
+      child: MultiBlocListener(
+        listeners: [
+          BlocListener<ChatCubit, ChatState>(
+            listener: (context, state) {
+              state.maybeWhen(
+                success: (reply) {
+                  if (_typingRowIndex != null) {
+                    _replaceTypingWithReply(_typingRowIndex!, reply);
+                    Analytics.instance
+                        .qnaAnswer(true, reply.lastVerified.isEmpty ? '2025-09-02' : reply.lastVerified);
+                    _typingRowIndex = null;
+                  }
+                },
+                error: (msg) {
+                  if (_typingRowIndex != null) {
+                    _replaceTypingWithError(_typingRowIndex!, msg);
+                    _typingRowIndex = null;
+                  }
+                },
+                orElse: () {},
+              );
             },
-            error: (msg) {
-              if (_typingRowIndex != null) {
-                _replaceTypingWithError(_typingRowIndex!, msg);
-                _typingRowIndex = null;
+          ),
+          BlocListener<ConversationCubit, ConversationState>(
+            listener: (context, state) {
+              if (state.message != null && state.message!.isNotEmpty) {
+                _appendBotText(state.message!);
+              }
+              if (state.question != null) {
+                _appendQuestion(
+                  state.question!.qid,
+                  state.question!.label,
+                  state.question!.choices,
+                  index: state.question!.index,
+                  total: state.question!.total,
+                  isSurvey: state.question!.isSurvey,
+                );
               }
+              if (state.result != null) {
+                _rows.add(_Row.result(ResultCard(
+                  status: state.result!.status,
+                  tldr: state.result!.tldr,
+                  reasons: state.result!.reasons,
+                  nextSteps: state.result!.nextSteps,
+                  lastVerified: state.result!.lastVerified,
+                )));
+                setState(() {});
+                _showSuggestionsAndAds();
+              }
+              setState(() => _awaitingChoice = state.awaitingChoice);
             },
-            orElse: () {},
-          );
-        },
+          ),
+        ],
         child: Scaffold(
           appBar: AppBar(title: const Text('ëŒ€í™”í˜• ì˜ˆë¹„íŒì •')),
           body: SafeArea(
@@ -361,17 +364,13 @@ class _ConversationPageState extends State<ConversationPage> {
                         ),
                       );
                     case _RowType.intake:
-                      final isSurvey = _isSurveyQid(row.qid!);
-                      final list = isSurvey ? _surveyFlow : _flow;
-                      final idx = list.indexWhere((e) => e.qid == row.qid);
-                      final total = list.length;
                       return Appear(
                         child: Padding(
                           padding: EdgeInsets.only(bottom: spacing.x4),
                           child: Column(
                             crossAxisAlignment: CrossAxisAlignment.start,
                             children: [
-                              ProgressInline(current: idx + 1, total: total, showBar: true),
+                              ProgressInline(current: row.index ?? 1, total: row.total ?? 1, showBar: true),
                               SizedBox(height: spacing.x1),
                               IntakeQuestion(
                                 qid: row.qid!,
@@ -709,6 +708,9 @@ class _Row {
   final Widget? richWidget;
   final Widget? adWidget;
   final List<_Suggestion>? suggestions;
+  final int? index;
+  final int? total;
+  final bool? isSurvey;
 
   _Row.bot(this.text)
       : type = _RowType.botText,
@@ -728,9 +730,12 @@ class _Row {
         resultCard = null,
         richWidget = null,
         adWidget = null,
-        suggestions = null;
+        suggestions = null,
+        index = null,
+        total = null,
+        isSurvey = null;
 
-  _Row.intake({required this.qid, required this.label, required this.choices})
+  _Row.intake({required this.qid, required this.label, required this.choices, this.index, this.total, this.isSurvey})
       : type = _RowType.intake,
         text = null,
         resultCard = null,
@@ -746,7 +751,10 @@ class _Row {
         choices = null,
         richWidget = null,
         adWidget = null,
-        suggestions = null;
+        suggestions = null,
+        index = null,
+        total = null,
+        isSurvey = null;
 
   _Row.botRich(this.richWidget)
       : type = _RowType.botRich,
@@ -756,7 +764,10 @@ class _Row {
         choices = null,
         resultCard = null,
         adWidget = null,
-        suggestions = null;
+        suggestions = null,
+        index = null,
+        total = null,
+        isSurvey = null;
 
   _Row.ad(this.adWidget)
       : type = _RowType.ad,
@@ -766,7 +777,10 @@ class _Row {
         choices = null,
         resultCard = null,
         richWidget = null,
-        suggestions = null;
+        suggestions = null,
+        index = null,
+        total = null,
+        isSurvey = null;
 
   _Row.suggestions(this.suggestions)
       : type = _RowType.suggestions,
@@ -776,7 +790,10 @@ class _Row {
         choices = null,
         resultCard = null,
         richWidget = null,
-        adWidget = null;
+        adWidget = null,
+        index = null,
+        total = null,
+        isSurvey = null;
 }
 
 class _Suggestion {
-- 
2.39.5 (Apple Git-154)


From 52eff7c1bb85f91adcd1677e7fe158bcb2e4be6a Mon Sep 17 00:00:00 2001
From: codex <codex@example.com>
Date: Wed, 3 Sep 2025 17:43:12 +0900
Subject: [PATCH 12/13] =?UTF-8?q?feat(ui):=20polish=20visuals=20=E2=80=94?=
 =?UTF-8?q?=20Card-based=20ResultCard=20with=20status=20pill=20and=20stale?=
 =?UTF-8?q?=20badge;=20refined=20ChatBubble=20paddings/radius;=20pill=20co?=
 =?UTF-8?q?mposer=20and=20ChipTheme?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 .../conversation/ui/conversation_page.dart    |  14 +--
 lib/ui/components/chat_bubble.dart            |  26 +++--
 lib/ui/components/result_card.dart            | 101 +++++++++++++-----
 lib/ui/theme/app_theme.dart                   |  10 +-
 4 files changed, 108 insertions(+), 43 deletions(-)

diff --git a/lib/features/conversation/ui/conversation_page.dart b/lib/features/conversation/ui/conversation_page.dart
index 5e3c4e6..01265d0 100644
--- a/lib/features/conversation/ui/conversation_page.dart
+++ b/lib/features/conversation/ui/conversation_page.dart
@@ -643,7 +643,7 @@ class _Composer extends StatelessWidget {
   Widget build(BuildContext context) {
     final spacing = context.spacing;
     final cs = Theme.of(context).colorScheme;
-    final radius = BorderRadius.circular(12);
+    final radius = BorderRadius.circular(22);
     return Container(
       padding: EdgeInsets.fromLTRB(spacing.x3, spacing.x2, spacing.x3, spacing.x2),
       decoration: BoxDecoration(
@@ -655,7 +655,7 @@ class _Composer extends StatelessWidget {
           Expanded(
             child: Material(
               elevation: enabled ? 2 : 0,
-              color: cs.surfaceVariant,
+              color: cs.surface,
               borderRadius: radius,
               child: TextField(
                 controller: controller,
@@ -673,14 +673,14 @@ class _Composer extends StatelessWidget {
             ),
           ),
           SizedBox(width: spacing.x2),
-          Container(
-            decoration: BoxDecoration(
-              color: enabled ? cs.primary : cs.surfaceVariant,
-              borderRadius: BorderRadius.circular(10),
-            ),
+          Material(
+            color: enabled ? cs.primary : cs.surfaceVariant,
+            elevation: enabled ? 3 : 0,
+            shape: const CircleBorder(),
             child: IconButton(
               onPressed: enabled ? onSend : null,
               icon: Icon(Icons.send, color: enabled ? cs.onPrimary : cs.onSurfaceVariant),
+              tooltip: 'ë³´ë‚´ê¸°',
             ),
           ),
         ],
diff --git a/lib/ui/components/chat_bubble.dart b/lib/ui/components/chat_bubble.dart
index 6d10be9..12bf63d 100644
--- a/lib/ui/components/chat_bubble.dart
+++ b/lib/ui/components/chat_bubble.dart
@@ -22,11 +22,12 @@ class ChatBubble extends StatelessWidget {
     final cs = Theme.of(context).colorScheme;
     final bubbleColor = isUser ? cs.primaryContainer : cs.surfaceVariant;
     final textColor = isUser ? cs.onPrimaryContainer : cs.onSurfaceVariant;
+    final r = context.corners.sm;
     final radius = BorderRadius.only(
-      topLeft: Radius.circular(context.corners.sm),
-      topRight: Radius.circular(context.corners.sm),
-      bottomLeft: Radius.circular(isUser ? context.corners.sm : 4),
-      bottomRight: Radius.circular(isUser ? 4 : context.corners.sm),
+      topLeft: Radius.circular(r),
+      topRight: Radius.circular(r),
+      bottomLeft: Radius.circular(isUser ? r : 6),
+      bottomRight: Radius.circular(isUser ? 6 : r),
     );
     return Semantics(
       label: 'Chat.${isUser ? 'user' : 'bot'}',
@@ -40,14 +41,17 @@ class ChatBubble extends StatelessWidget {
               mainAxisAlignment: isUser ? MainAxisAlignment.end : MainAxisAlignment.start,
               children: [
                 Flexible(
-                  child: Container(
-                    padding: EdgeInsets.all(spacing.x3),
-                    constraints: const BoxConstraints(maxWidth: 560),
-                    decoration: BoxDecoration(
-                      color: bubbleColor,
-                      borderRadius: radius,
+                  child: Material(
+                    color: bubbleColor,
+                    elevation: 0,
+                    borderRadius: radius,
+                    child: Padding(
+                      padding: EdgeInsets.all(spacing.x3),
+                      child: Text(
+                        content,
+                        style: Theme.of(context).textTheme.bodyMedium?.copyWith(color: textColor),
+                      ),
                     ),
-                    child: Text(content, style: Theme.of(context).textTheme.bodyMedium?.copyWith(color: textColor)),
                   ),
                 ),
               ],
diff --git a/lib/ui/components/result_card.dart b/lib/ui/components/result_card.dart
index 159fdc6..d726976 100644
--- a/lib/ui/components/result_card.dart
+++ b/lib/ui/components/result_card.dart
@@ -68,23 +68,47 @@ class ResultCard extends StatelessWidget {
     final corners = context.corners;
     return Semantics(
       label: 'ResultCard',
-      child: Container(
+      child: Card(
         key: const Key('ResultCard.Container'),
-        width: double.infinity,
-        padding: EdgeInsets.all(spacing.x4),
-        decoration: BoxDecoration(
-          color: Theme.of(context).colorScheme.surface,
-          borderRadius: BorderRadius.circular(corners.md),
-          border: Border.all(color: Theme.of(context).colorScheme.outlineVariant),
-        ),
-        child: Column(
+        elevation: 2,
+        clipBehavior: Clip.antiAlias,
+        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(corners.md)),
+        child: Container(
+          width: double.infinity,
+          padding: EdgeInsets.all(spacing.x4),
+          decoration: BoxDecoration(
+            gradient: LinearGradient(
+              begin: Alignment.topCenter,
+              end: Alignment.bottomCenter,
+              colors: [
+                Theme.of(context).colorScheme.surface,
+                Theme.of(context).colorScheme.surface.withOpacity(0.96),
+              ],
+            ),
+          ),
+          child: Column(
           crossAxisAlignment: CrossAxisAlignment.start,
           children: [
             Row(
               children: [
-                Icon(_statusIcon(), color: _statusColor(context)),
-                SizedBox(width: spacing.x2),
-                Text(_statusLabel(), style: Theme.of(context).textTheme.titleSmall?.copyWith(color: _statusColor(context))),
+                Container(
+                  padding: EdgeInsets.symmetric(horizontal: spacing.x2, vertical: spacing.x1),
+                  decoration: BoxDecoration(
+                    color: _statusColor(context).withOpacity(0.12),
+                    borderRadius: BorderRadius.circular(999),
+                  ),
+                  child: Row(
+                    mainAxisSize: MainAxisSize.min,
+                    children: [
+                      Icon(_statusIcon(), color: _statusColor(context), size: 16),
+                      SizedBox(width: spacing.x1),
+                      Text(
+                        _statusLabel(),
+                        style: Theme.of(context).textTheme.labelMedium?.copyWith(color: _statusColor(context)),
+                      ),
+                    ],
+                  ),
+                ),
                 const Spacer(),
                 _LastVerifiedBadge(lastVerified: lastVerified),
               ],
@@ -143,6 +167,7 @@ class ResultCard extends StatelessWidget {
             ],
           ],
         ),
+        ),
       ),
     );
   }
@@ -170,20 +195,48 @@ class _LastVerifiedBadge extends StatelessWidget {
   Widget build(BuildContext context) {
     final spacing = context.spacing;
     final cs = Theme.of(context).colorScheme;
-    return Container(
-      padding: EdgeInsets.symmetric(horizontal: spacing.x2, vertical: spacing.x1),
-      decoration: BoxDecoration(
-        color: cs.surfaceVariant,
-        borderRadius: BorderRadius.circular(12),
-      ),
-      child: Row(
-        mainAxisSize: MainAxisSize.min,
-        children: [
-          const Icon(Icons.schedule, size: 14),
+    final stale = _isStale(lastVerified);
+    return Row(
+      mainAxisSize: MainAxisSize.min,
+      children: [
+        Container(
+          padding: EdgeInsets.symmetric(horizontal: spacing.x2, vertical: spacing.x1),
+          decoration: BoxDecoration(
+            color: cs.surfaceVariant,
+            borderRadius: BorderRadius.circular(12),
+          ),
+          child: Row(
+            mainAxisSize: MainAxisSize.min,
+            children: [
+              const Icon(Icons.schedule, size: 14),
+              SizedBox(width: spacing.x1),
+              Text('ë§ˆì§€ë§‰ í™•ì¸ì¼ $lastVerified', style: Theme.of(context).textTheme.labelSmall),
+            ],
+          ),
+        ),
+        if (stale) ...[
           SizedBox(width: spacing.x1),
-          Text('ë§ˆì§€ë§‰ í™•ì¸ì¼ $lastVerified', style: Theme.of(context).textTheme.labelSmall),
+          Container(
+            padding: EdgeInsets.symmetric(horizontal: spacing.x2, vertical: spacing.x1),
+            decoration: BoxDecoration(
+              color: cs.errorContainer,
+              borderRadius: BorderRadius.circular(12),
+            ),
+            child: Text(
+              'ì •ë³´ ìµœì‹ ì„± í™•ì¸ í•„ìš”',
+              style: Theme.of(context).textTheme.labelSmall?.copyWith(color: cs.onErrorContainer),
+            ),
+          ),
         ],
-      ),
+      ],
     );
   }
+  bool _isStale(String ymd) {
+    try {
+      final d = DateTime.parse(ymd);
+      return DateTime.now().difference(d).inDays > 30;
+    } catch (_) {
+      return false;
+    }
+  }
 }
diff --git a/lib/ui/theme/app_theme.dart b/lib/ui/theme/app_theme.dart
index 1e16820..13dc231 100644
--- a/lib/ui/theme/app_theme.dart
+++ b/lib/ui/theme/app_theme.dart
@@ -43,6 +43,15 @@ ThemeData buildAppTheme(Brightness brightness) {
       bodyMedium: base.textTheme.bodyMedium?.copyWith(height: 1.4),
       labelLarge: base.textTheme.labelLarge?.copyWith(letterSpacing: 0.2),
     ),
+    chipTheme: base.chipTheme.copyWith(
+      labelStyle: base.textTheme.labelLarge?.copyWith(letterSpacing: 0.1),
+      padding: const EdgeInsetsDirectional.symmetric(horizontal: 12, vertical: 8),
+      side: BorderSide(color: scheme.outlineVariant),
+      selectedColor: scheme.primaryContainer,
+      backgroundColor: scheme.surfaceVariant,
+      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
+      showCheckmark: false,
+    ),
     inputDecorationTheme: const InputDecorationTheme(
       border: OutlineInputBorder(),
     ),
@@ -65,4 +74,3 @@ extension ThemeGetters on BuildContext {
   Spacing get spacing => Theme.of(this).extension<Spacing>() ?? const Spacing();
   Corners get corners => Theme.of(this).extension<Corners>() ?? const Corners();
 }
-
-- 
2.39.5 (Apple Git-154)


From eb19f8fd06ffb16df7aef44951d7366827d4c89e Mon Sep 17 00:00:00 2001
From: codex <codex@example.com>
Date: Wed, 3 Sep 2025 17:56:26 +0900
Subject: [PATCH 13/13] feat(ui): add delayed Appear for staggered list
 animations and animated scale on Composer send button

---
 .../conversation/ui/conversation_page.dart    | 27 ++++++++++----
 lib/ui/components/appear.dart                 | 37 +++++++++++++++----
 2 files changed, 49 insertions(+), 15 deletions(-)

diff --git a/lib/features/conversation/ui/conversation_page.dart b/lib/features/conversation/ui/conversation_page.dart
index 01265d0..e975b90 100644
--- a/lib/features/conversation/ui/conversation_page.dart
+++ b/lib/features/conversation/ui/conversation_page.dart
@@ -351,6 +351,7 @@ class _ConversationPageState extends State<ConversationPage> {
                   switch (row.type) {
                     case _RowType.botText:
                       return Appear(
+                        delay: Duration(milliseconds: 40),
                         child: Padding(
                           padding: EdgeInsets.only(bottom: spacing.x3),
                           child: ChatBubble(role: ChatRole.bot, content: row.text ?? ''),
@@ -358,6 +359,7 @@ class _ConversationPageState extends State<ConversationPage> {
                       );
                     case _RowType.userText:
                       return Appear(
+                        delay: Duration(milliseconds: 40),
                         child: Padding(
                           padding: EdgeInsets.only(bottom: spacing.x3),
                           child: ChatBubble(role: ChatRole.user, content: row.text ?? ''),
@@ -365,6 +367,7 @@ class _ConversationPageState extends State<ConversationPage> {
                       );
                     case _RowType.intake:
                       return Appear(
+                        delay: Duration(milliseconds: 60),
                         child: Padding(
                           padding: EdgeInsets.only(bottom: spacing.x4),
                           child: Column(
@@ -385,6 +388,7 @@ class _ConversationPageState extends State<ConversationPage> {
                       );
                     case _RowType.ad:
                       return Appear(
+                        delay: Duration(milliseconds: 80),
                         child: Padding(
                           padding: EdgeInsets.only(bottom: spacing.x4),
                           child: row.adWidget!,
@@ -393,6 +397,7 @@ class _ConversationPageState extends State<ConversationPage> {
                     case _RowType.suggestions:
                       return Appear(
                         duration: const Duration(milliseconds: 120),
+                        delay: Duration(milliseconds: 50),
                         child: Padding(
                           padding: EdgeInsets.only(bottom: spacing.x3),
                           child: Wrap(
@@ -426,6 +431,7 @@ class _ConversationPageState extends State<ConversationPage> {
                       );
                     case _RowType.botRich:
                       return Appear(
+                        delay: Duration(milliseconds: 50),
                         duration: const Duration(milliseconds: 120),
                         child: Padding(
                           padding: EdgeInsets.only(bottom: spacing.x3),
@@ -673,14 +679,19 @@ class _Composer extends StatelessWidget {
             ),
           ),
           SizedBox(width: spacing.x2),
-          Material(
-            color: enabled ? cs.primary : cs.surfaceVariant,
-            elevation: enabled ? 3 : 0,
-            shape: const CircleBorder(),
-            child: IconButton(
-              onPressed: enabled ? onSend : null,
-              icon: Icon(Icons.send, color: enabled ? cs.onPrimary : cs.onSurfaceVariant),
-              tooltip: 'ë³´ë‚´ê¸°',
+          AnimatedScale(
+            scale: enabled ? 1.0 : 0.96,
+            duration: const Duration(milliseconds: 150),
+            curve: Curves.easeOut,
+            child: Material(
+              color: enabled ? cs.primary : cs.surfaceVariant,
+              elevation: enabled ? 3 : 0,
+              shape: const CircleBorder(),
+              child: IconButton(
+                onPressed: enabled ? onSend : null,
+                icon: Icon(Icons.send, color: enabled ? cs.onPrimary : cs.onSurfaceVariant),
+                tooltip: 'ë³´ë‚´ê¸°',
+              ),
             ),
           ),
         ],
diff --git a/lib/ui/components/appear.dart b/lib/ui/components/appear.dart
index cd98773..589ca08 100644
--- a/lib/ui/components/appear.dart
+++ b/lib/ui/components/appear.dart
@@ -1,11 +1,12 @@
 import 'package:flutter/material.dart';
 
-/// Simple fade + slight y-translate appear animation.
-class Appear extends StatelessWidget {
+/// Simple fade + slight y-translate appear animation with optional delay.
+class Appear extends StatefulWidget {
   final Widget child;
   final Duration duration;
   final Curve curve;
   final double offsetY;
+  final Duration delay;
 
   const Appear({
     super.key,
@@ -13,22 +14,44 @@ class Appear extends StatelessWidget {
     this.duration = const Duration(milliseconds: 200), // tokens.motion.durations_ms.normal
     this.curve = Curves.easeOut, // tokens.motion.easing.standard
     this.offsetY = 12,
+    this.delay = Duration.zero,
   });
 
+  @override
+  State<Appear> createState() => _AppearState();
+}
+
+class _AppearState extends State<Appear> {
+  bool _start = false;
+
+  @override
+  void initState() {
+    super.initState();
+    if (widget.delay == Duration.zero) {
+      _start = true;
+    } else {
+      Future.delayed(widget.delay, () {
+        if (mounted) setState(() => _start = true);
+      });
+    }
+  }
+
   @override
   Widget build(BuildContext context) {
+    if (!_start) {
+      return Opacity(opacity: 0, child: Transform.translate(offset: Offset(0, widget.offsetY), child: widget.child));
+    }
     return TweenAnimationBuilder<double>(
       tween: Tween(begin: 0, end: 1),
-      duration: duration,
-      curve: curve,
+      duration: widget.duration,
+      curve: widget.curve,
       builder: (context, t, _) => Opacity(
         opacity: t,
         child: Transform.translate(
-          offset: Offset(0, (1 - t) * offsetY),
-          child: child,
+          offset: Offset(0, (1 - t) * widget.offsetY),
+          child: widget.child,
         ),
       ),
     );
   }
 }
-
-- 
2.39.5 (Apple Git-154)

